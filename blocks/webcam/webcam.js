import e from"https://cdn.jsdelivr.net/npm/@finos/perspective@3.0.0/dist/cdn/perspective.js";const t=document.getElementById("canvas"),a=t.getContext("2d",{willReadFrequently:!0}),o=document.getElementById("video"),n=t.width,i=t.height,c=await e.worker();async function r(e,t){a.drawImage(o,0,0,n,i);const c=a.getImageData(0,0,n,i);for(let a=0;a<c.data.byteLength/4;a++){const e=255-(.21*c.data[4*a]+.72*c.data[4*a+1]+.07*c.data[4*a+2]);t.color[a]=e}await e.update(t),setTimeout((()=>r(e,t)),50)}const s=[async function(){if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){const e=await navigator.mediaDevices.getUserMedia({video:!0});o.srcObject=e,o.play()}const e={index:[],color:[]};for(let a=0;a<n*i;a++)e.index[a]=a,e.color[a]=0;const t=await c.table(e,{index:"index"});return r(t,e),t}(),async function(){const e=await fetch("layouts.json");return await e.json()}()],[d,l]=await Promise.all(s),g=!/(iPad|iPhone|iPod)/g.test(navigator.userAgent),u=document.querySelector("select"),v=document.querySelector("perspective-viewer");v.load(d),await v.restore({settings:g,...l[0]});const m=document.querySelector("perspective-viewer-datagrid").shadowRoot.querySelector("regular-table");m.scrollTop=m.scrollHeight/2-m.clientHeight/2,m.scrollLeft=m.scrollWidth/2-m.clientWidth/2;for(const p of l){const e=document.createElement("option");e.value=p.title,e.textContent=p.title,u.appendChild(e)}u.addEventListener("change",(async e=>{const t=l.find((t=>t.title===e.target.value));await v.restore(t)}));