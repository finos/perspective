import"https://cdn.jsdelivr.net/npm/@finos/perspective-viewer@3.1.3/dist/cdn/perspective-viewer.js";import"https://cdn.jsdelivr.net/npm/@finos/perspective-viewer-datagrid@3.1.3/dist/cdn/perspective-viewer-datagrid.js";import"https://cdn.jsdelivr.net/npm/@finos/perspective-viewer-d3fc@3.1.3/dist/cdn/perspective-viewer-d3fc.js";import n from"https://cdn.jsdelivr.net/npm/@finos/perspective@3.1.3/dist/cdn/perspective.js";function e(n){return`\n// color\nvar resolution := ${n.resolution};\nvar xmin := ${n.xmin};\nvar xmax := ${n.xmax};\nvar ymin := ${n.ymin};\nvar ymax := ${n.ymax};\nvar iterations := ${n.iterations};\n\nvar x := floor("index" / resolution);\nvar y := "index" % resolution;\nvar c := iterations;\n\nvar cx := xmin + ((xmax - xmin) * x) / (resolution - 1);\nvar cy := ymin + ((ymax - ymin) * y) / (resolution - 1);\n\nvar vx := 0;\nvar vy := 0;\nvar vxx := 0;\nvar vyy := 0;\nvar vxy := 0;\n\nfor (var ii := 0; ii < iterations; ii += 1) {\n    if (vxx + vyy <= float(4)) {\n        vxy := vx * vy;\n        vxx := vx * vx;\n        vyy := vy * vy;\n        vx := vxx - vyy + cx;\n        vy := vxy + vxy + cy;\n        c -= 1;\n    }\n};\n\nc`}function i(n,e,i){n.addEventListener("input",(()=>{window.run.disabled=!1,n.value=Math.min(n.valueAsNumber,e.valueAsNumber-.1)})),e.addEventListener("input",(()=>{window.run.disabled=!1,e.value=Math.max(n.valueAsNumber+.1,e.valueAsNumber)}))}function r(){window.run.disabled=!1}var t,o;(await window.viewer.getPlugin("Heatmap")).max_cells=1e5,i(xmin,xmax),i(ymin,ymax),window.resolution.addEventListener("input",r),window.iterations.addEventListener("input",r),run.addEventListener("click",(t=await n.worker(),o={},async()=>{if("Run"!==window.run.innerHTML.trim())return void(window.run.innerHTML="Run");window.run.disabled=!0,o.table||(o.table=await t.table({index:"integer"}),window.viewer.load(Promise.resolve(o.table)));const n=document.getElementById("run"),i=["xmin","xmax","ymin","ymax","resolution","iterations"].reduce(((n,e)=>(n[e]=window[e].valueAsNumber,n)),{}),r=Math.pow(i.resolution,2);if(!o.size||o.size!==r){let n={index:new Array(r)};for(let e=0;e<r;++e)n.index[e]=e;o.table.replace(n)}o.size=r,n.innerHTML="Run",window.viewer.restore(function(n){return{plugin:"Heatmap",settings:!0,group_by:[`floor("index" / ${n.resolution})`],split_by:[`"index" % ${n.resolution}`],columns:["color"],expressions:{color:e(n).trim(),[`floor("index" / ${n.resolution})`]:`floor("index" / ${n.resolution})`,[`"index" % ${n.resolution}`]:`"index" % ${n.resolution}`}}}(i))})),run.dispatchEvent(new Event("click"));