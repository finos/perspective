(self.webpackChunk_finos_perspective_docs=self.webpackChunk_finos_perspective_docs||[]).push([[978],{6978:(e,t,n)=>{n.r(t),n.d(t,{default:()=>_e,init_client:()=>ee,init_server:()=>Y,websocket:()=>ne,worker:()=>re});var r=Object.defineProperty,_={};((e,t)=>{for(var n in t)r(e,n,{get:t[n],enumerable:!0})})(_,{Client:()=>U,ProxySession:()=>N,Table:()=>P,View:()=>R,default:()=>z,init:()=>S,initSync:()=>T});var i,o=new Array(128).fill(void 0);function s(e){return o[e]}o.push(void 0,null,!0,!1);var a=0,c=null;function u(){return(null===c||0===c.byteLength)&&(c=new Uint8Array(i.memory.buffer)),c}var l=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},b=function(e,t){return l.encodeInto(e,t)};function w(e,t,n){if(void 0===n){let n=l.encode(e),r=t(n.length,1)>>>0;return u().subarray(r,r+n.length).set(n),a=n.length,r}let r=e.length,_=t(r,1)>>>0,i=u(),o=0;for(;o<r;o++){let t=e.charCodeAt(o);if(t>127)break;i[_+o]=t}if(o!==r){0!==o&&(e=e.slice(o)),_=n(_,r,r=o+3*e.length,1)>>>0;let t=u().subarray(_+o,_+r);o+=b(e,t).written,_=n(_,r,o,1)>>>0}return a=o,_}var g=null;function f(){return(null===g||!0===g.buffer.detached||void 0===g.buffer.detached&&g.buffer!==i.memory.buffer)&&(g=new DataView(i.memory.buffer)),g}var d=o.length;function p(e){d===o.length&&o.push(o.length+1);let t=d;return d=o[t],o[t]=e,t}function h(e,t){try{return e.apply(this,t)}catch(n){i.__wbindgen_export_2(p(n))}}var y=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};function m(e,t){return e>>>=0,y.decode(u().subarray(e,e+t))}function v(e){return null==e}function A(e){let t=s(e);return function(e){e<132||(o[e]=d,d=e)}(e),t}typeof TextDecoder<"u"&&y.decode();var x=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>{i.__wbindgen_export_4.get(e.dtor)(e.a,e.b)}));function I(e){let t=typeof e;if("number"==t||"boolean"==t||null==e)return`${e}`;if("string"==t)return`"${e}"`;if("symbol"==t){let t=e.description;return null==t?"Symbol":`Symbol(${t})`}if("function"==t){let t=e.name;return"string"==typeof t&&t.length>0?`Function(${t})`:"Function"}if(Array.isArray(e)){let t=e.length,n="[";t>0&&(n+=I(e[0]));for(let r=1;r<t;r++)n+=", "+I(e[r]);return n+="]",n}let n,r=/\[object ([^\]]+)\]/.exec(toString.call(e));if(!(r&&r.length>1))return toString.call(e);if(n=r[1],"Object"==n)try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}\n${e.stack}`:n}var k=128;function E(e){if(1==k)throw new Error("out of js stack");return o[--k]=e,k}function S(){i.init()}function O(e,t){return A(i.__wbindgen_export_5(e,t))}function j(e,t,n){i.__wbindgen_export_6(e,t,p(n))}var W=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>i.__wbg_client_free(e>>>0,1))),U=class e{static __wrap(t){t>>>=0;let n=Object.create(e.prototype);return n.__wbg_ptr=t,W.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,W.unregister(this),e}free(){let e=this.__destroy_into_raw();i.__wbg_client_free(e,0)}__getClassname(){let e,t;try{let _=i.__wbindgen_add_to_stack_pointer(-16);i.client___getClassname(_,this.__wbg_ptr);var n=f().getInt32(_+0,!0),r=f().getInt32(_+4,!0);return e=n,t=r,m(n,r)}finally{i.__wbindgen_add_to_stack_pointer(16),i.__wbindgen_export_3(e,t,1)}}constructor(e,t){try{let _=i.__wbindgen_add_to_stack_pointer(-16);i.client_new(_,p(e),v(t)?0:p(t));var n=f().getInt32(_+0,!0),r=f().getInt32(_+4,!0);if(f().getInt32(_+8,!0))throw A(r);return this.__wbg_ptr=n>>>0,W.register(this,this.__wbg_ptr,this),this}finally{i.__wbindgen_add_to_stack_pointer(16)}}new_proxy_session(e){try{let t=i.client_new_proxy_session(this.__wbg_ptr,E(e));return N.__wrap(t)}finally{o[k++]=void 0}}init(){return A(i.client_init(this.__wbg_ptr))}handle_response(e){return A(i.client_handle_response(this.__wbg_ptr,p(e)))}handle_error(e,t){let n=w(e,i.__wbindgen_export_0,i.__wbindgen_export_1),r=a;return A(i.client_handle_error(this.__wbg_ptr,n,r,v(t)?0:p(t)))}on_error(e){return A(i.client_on_error(this.__wbg_ptr,p(e)))}table(e,t){return A(i.client_table(this.__wbg_ptr,p(e),v(t)?0:p(t)))}terminate(){try{let n=i.__wbindgen_add_to_stack_pointer(-16);i.client_terminate(n,this.__wbg_ptr);var e=f().getInt32(n+0,!0),t=f().getInt32(n+4,!0);if(f().getInt32(n+8,!0))throw A(t);return A(e)}finally{i.__wbindgen_add_to_stack_pointer(16)}}open_table(e){let t=w(e,i.__wbindgen_export_0,i.__wbindgen_export_1),n=a;return A(i.client_open_table(this.__wbg_ptr,t,n))}get_hosted_table_names(){return A(i.client_get_hosted_table_names(this.__wbg_ptr))}on_hosted_tables_update(e){return A(i.client_on_hosted_tables_update(this.__wbg_ptr,p(e)))}remove_hosted_tables_update(e){return A(i.client_remove_hosted_tables_update(this.__wbg_ptr,e))}system_info(){return A(i.client_system_info(this.__wbg_ptr))}},L=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>i.__wbg_proxysession_free(e>>>0,1))),N=class e{static __wrap(t){t>>>=0;let n=Object.create(e.prototype);return n.__wbg_ptr=t,L.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,L.unregister(this),e}free(){let e=this.__destroy_into_raw();i.__wbg_proxysession_free(e,0)}constructor(e,t){try{!function(e,t){if(!(e instanceof t))throw new Error(`expected instance of ${t.name}`)}(e,U);let n=i.client_new_proxy_session(e.__wbg_ptr,E(t));return this.__wbg_ptr=n>>>0,L.register(this,this.__wbg_ptr,this),this}finally{o[k++]=void 0}}handle_request(e){return A(i.proxysession_handle_request(this.__wbg_ptr,p(e)))}close(){let e=this.__destroy_into_raw();return A(i.proxysession_close(e))}},B=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>i.__wbg_table_free(e>>>0,1))),P=class e{static __wrap(t){t>>>=0;let n=Object.create(e.prototype);return n.__wbg_ptr=t,B.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,B.unregister(this),e}free(){let e=this.__destroy_into_raw();i.__wbg_table_free(e,0)}__getClassname(){let e,t;try{let _=i.__wbindgen_add_to_stack_pointer(-16);i.table___getClassname(_,this.__wbg_ptr);var n=f().getInt32(_+0,!0),r=f().getInt32(_+4,!0);return e=n,t=r,m(n,r)}finally{i.__wbindgen_add_to_stack_pointer(16),i.__wbindgen_export_3(e,t,1)}}get_index(){return A(i.table_get_index(this.__wbg_ptr))}get_client(){return A(i.table_get_client(this.__wbg_ptr))}get_name(){return A(i.table_get_name(this.__wbg_ptr))}get_limit(){return A(i.table_get_limit(this.__wbg_ptr))}clear(){return A(i.table_clear(this.__wbg_ptr))}delete(e){let t=this.__destroy_into_raw();return A(i.table_delete(t,v(e)?0:p(e)))}size(){return A(i.table_size(this.__wbg_ptr))}schema(){return A(i.table_schema(this.__wbg_ptr))}columns(){return A(i.table_columns(this.__wbg_ptr))}make_port(){return A(i.table_make_port(this.__wbg_ptr))}on_delete(e){return A(i.table_on_delete(this.__wbg_ptr,p(e)))}remove_delete(e){return A(i.table_remove_delete(this.__wbg_ptr,e))}remove(e,t){return A(i.table_remove(this.__wbg_ptr,p(e),v(t)?0:p(t)))}replace(e,t){return A(i.table_replace(this.__wbg_ptr,p(e),v(t)?0:p(t)))}update(e,t){return A(i.table_update(this.__wbg_ptr,p(e),v(t)?0:p(t)))}view(e){return A(i.table_view(this.__wbg_ptr,v(e)?0:p(e)))}validate_expressions(e){return A(i.table_validate_expressions(this.__wbg_ptr,p(e)))}},M=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry((e=>i.__wbg_view_free(e>>>0,1))),R=class e{static __wrap(t){t>>>=0;let n=Object.create(e.prototype);return n.__wbg_ptr=t,M.register(n,n.__wbg_ptr,n),n}static __unwrap(t){return t instanceof e?t.__destroy_into_raw():0}__destroy_into_raw(){let e=this.__wbg_ptr;return this.__wbg_ptr=0,M.unregister(this),e}free(){let e=this.__destroy_into_raw();i.__wbg_view_free(e,0)}__get_model(){let t=i.view___get_model(this.__wbg_ptr);return e.__wrap(t)}column_paths(){return A(i.view_column_paths(this.__wbg_ptr))}delete(){let e=this.__destroy_into_raw();return A(i.view_delete(e))}dimensions(){return A(i.view_dimensions(this.__wbg_ptr))}expression_schema(){return A(i.view_expression_schema(this.__wbg_ptr))}get_config(){return A(i.view_get_config(this.__wbg_ptr))}get_min_max(e){let t=w(e,i.__wbindgen_export_0,i.__wbindgen_export_1),n=a;return A(i.view_get_min_max(this.__wbg_ptr,t,n))}num_rows(){return A(i.view_num_rows(this.__wbg_ptr))}schema(){return A(i.view_schema(this.__wbg_ptr))}to_arrow(e){return A(i.view_to_arrow(this.__wbg_ptr,v(e)?0:p(e)))}to_columns_string(e){return A(i.view_to_columns_string(this.__wbg_ptr,v(e)?0:p(e)))}to_columns(e){return A(i.view_to_columns(this.__wbg_ptr,v(e)?0:p(e)))}to_json_string(e){return A(i.view_to_json_string(this.__wbg_ptr,v(e)?0:p(e)))}to_json(e){return A(i.view_to_json(this.__wbg_ptr,v(e)?0:p(e)))}to_ndjson(e){return A(i.view_to_ndjson(this.__wbg_ptr,v(e)?0:p(e)))}to_csv(e){return A(i.view_to_csv(this.__wbg_ptr,v(e)?0:p(e)))}on_update(e,t){return A(i.view_on_update(this.__wbg_ptr,p(e),v(t)?0:p(t)))}remove_update(e){return A(i.view_remove_update(this.__wbg_ptr,e))}on_delete(e){return A(i.view_on_delete(this.__wbg_ptr,p(e)))}num_columns(){return A(i.view_num_columns(this.__wbg_ptr))}remove_delete(e){return A(i.view_remove_delete(this.__wbg_ptr,e))}collapse(e){return A(i.view_collapse(this.__wbg_ptr,e))}expand(e){return A(i.view_expand(this.__wbg_ptr,e))}set_depth(e){return A(i.view_set_depth(this.__wbg_ptr,e))}};function q(){let e={wbg:{}};return e.wbg.__wbg_String_8f0eb39a4a4c2f66=function(e,t){let n=w(String(s(t)),i.__wbindgen_export_0,i.__wbindgen_export_1),r=a;f().setInt32(e+4,r,!0),f().setInt32(e+0,n,!0)},e.wbg.__wbg_at_7d852dd9f194d43e=function(e,t){return p(s(e).at(t))},e.wbg.__wbg_buffer_09165b52af8c5237=function(e){return p(s(e).buffer)},e.wbg.__wbg_buffer_609cc3eee51ed158=function(e){return p(s(e).buffer)},e.wbg.__wbg_call_672a4d21634d4a24=function(){return h((function(e,t){return p(s(e).call(s(t)))}),arguments)},e.wbg.__wbg_call_7cccdd69e0791ae2=function(){return h((function(e,t,n){return p(s(e).call(s(t),s(n)))}),arguments)},e.wbg.__wbg_call_833bed5770ea2041=function(){return h((function(e,t,n,r){return p(s(e).call(s(t),s(n),s(r)))}),arguments)},e.wbg.__wbg_client_new=function(e){return p(U.__wrap(e))},e.wbg.__wbg_debug_3cb59063b29f58c1=function(e){console.debug(s(e))},e.wbg.__wbg_debug_e17b51583ca6a632=function(e,t,n,r){console.debug(s(e),s(t),s(n),s(r))},e.wbg.__wbg_done_769e5ede4b31c67b=function(e){return s(e).done},e.wbg.__wbg_entries_3265d4158b33e5dc=function(e){return p(Object.entries(s(e)))},e.wbg.__wbg_error_1004b8c64097413f=function(e,t){console.error(s(e),s(t))},e.wbg.__wbg_error_524f506f44df1645=function(e){console.error(s(e))},e.wbg.__wbg_error_7534b8e9a36f1ab4=function(e,t){let n,r;try{n=e,r=t,console.error(m(e,t))}finally{i.__wbindgen_export_3(n,r,1)}},e.wbg.__wbg_error_80de38b3f7cc3c3c=function(e,t,n,r){console.error(s(e),s(t),s(n),s(r))},e.wbg.__wbg_from_2a5d3e218e67aa85=function(e){return p(Array.from(s(e)))},e.wbg.__wbg_getEntriesByName_2a5a14d4b09f36a4=function(e,t,n,r,_){return p(s(e).getEntriesByName(m(t,n),m(r,_)))},e.wbg.__wbg_getRandomValues_21a0191e74d0e1d3=function(){return h((function(e,t){globalThis.crypto.getRandomValues(function(e,t){return e>>>=0,u().subarray(e/1,e/1+t)}(e,t))}),arguments)},e.wbg.__wbg_get_67b2ba62fc30de12=function(){return h((function(e,t){return p(Reflect.get(s(e),s(t)))}),arguments)},e.wbg.__wbg_get_74b8744f6a23f4fa=function(e,t,n){let r=s(e)[m(t,n)];return v(r)?0:p(r)},e.wbg.__wbg_get_b9b93047fe3cf45b=function(e,t){return p(s(e)[t>>>0])},e.wbg.__wbg_getwithrefkey_1dc361bd10053bfe=function(e,t){return p(s(e)[s(t)])},e.wbg.__wbg_has_a5ea9117f258a0ec=function(){return h((function(e,t){return Reflect.has(s(e),s(t))}),arguments)},e.wbg.__wbg_info_033d8b8a0838f1d3=function(e,t,n,r){console.info(s(e),s(t),s(n),s(r))},e.wbg.__wbg_info_3daf2e093e091b66=function(e){console.info(s(e))},e.wbg.__wbg_instanceof_ArrayBuffer_e14585432e3737fc=function(e){let t;try{t=s(e)instanceof ArrayBuffer}catch{t=!1}return t},e.wbg.__wbg_instanceof_Array_6ac07133d621675a=function(e){let t;try{t=s(e)instanceof Array}catch{t=!1}return t},e.wbg.__wbg_instanceof_Error_4d54113b22d20306=function(e){let t;try{t=s(e)instanceof Error}catch{t=!1}return t},e.wbg.__wbg_instanceof_Map_f3469ce2244d2430=function(e){let t;try{t=s(e)instanceof Map}catch{t=!1}return t},e.wbg.__wbg_instanceof_Object_7f2dcef8f78644a4=function(e){let t;try{t=s(e)instanceof Object}catch{t=!1}return t},e.wbg.__wbg_instanceof_Uint8Array_17156bcf118086a9=function(e){let t;try{t=s(e)instanceof Uint8Array}catch{t=!1}return t},e.wbg.__wbg_instanceof_Window_def73ea0955fc569=function(e){let t;try{t=s(e)instanceof Window}catch{t=!1}return t},e.wbg.__wbg_isArray_a1eab7e0d067391b=function(e){return Array.isArray(s(e))},e.wbg.__wbg_isSafeInteger_343e2beeeece1bb0=function(e){return Number.isSafeInteger(s(e))},e.wbg.__wbg_iterator_9a24c88df860dc65=function(){return p(Symbol.iterator)},e.wbg.__wbg_keys_5c77a08ddc2fb8a6=function(e){return p(Object.keys(s(e)))},e.wbg.__wbg_length_a446193dc22c12f8=function(e){return s(e).length},e.wbg.__wbg_length_e2d2a49132c1b256=function(e){return s(e).length},e.wbg.__wbg_mark_001da84b098c950f=function(){return h((function(e,t,n){s(e).mark(m(t,n))}),arguments)},e.wbg.__wbg_measure_65e49f8bc0e203a8=function(){return h((function(e,t,n,r,_){s(e).measure(m(t,n),m(r,_))}),arguments)},e.wbg.__wbg_message_97a2af9b89d693a3=function(e){return p(s(e).message)},e.wbg.__wbg_new_23a2665fac83c611=function(e,t){try{var n={a:e,b:t};let r=new Promise(((e,t)=>{let r=n.a;n.a=0;try{return function(e,t,n,r){i.__wbindgen_export_7(e,t,p(n),p(r))}(r,n.b,e,t)}finally{n.a=r}}));return p(r)}finally{n.a=n.b=0}},e.wbg.__wbg_new_405e22f390576ce2=function(){return p(new Object)},e.wbg.__wbg_new_5e0be73521bc8c17=function(){return p(new Map)},e.wbg.__wbg_new_78feb108b6472713=function(){return p(new Array)},e.wbg.__wbg_new_8a6f238a6ece86ea=function(){return p(new Error)},e.wbg.__wbg_new_a12002a7f91c75be=function(e){return p(new Uint8Array(s(e)))},e.wbg.__wbg_new_c68d7209be747379=function(e,t){return p(new Error(m(e,t)))},e.wbg.__wbg_newnoargs_105ed471475aaf50=function(e,t){return p(new Function(m(e,t)))},e.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(e,t,n){return p(new Uint8Array(s(e),t>>>0,n>>>0))},e.wbg.__wbg_next_25feadfc0913fea9=function(e){return p(s(e).next)},e.wbg.__wbg_next_6574e1a8a62d1055=function(){return h((function(e){return p(s(e).next())}),arguments)},e.wbg.__wbg_now_d18023d54d4e5500=function(e){return s(e).now()},e.wbg.__wbg_parse_def2e24ef1252aff=function(){return h((function(e,t){return p(JSON.parse(m(e,t)))}),arguments)},e.wbg.__wbg_performance_c185c0cdc2766575=function(e){let t=s(e).performance;return v(t)?0:p(t)},e.wbg.__wbg_push_737cfc8c1432c2c6=function(e,t){return s(e).push(s(t))},e.wbg.__wbg_queueMicrotask_6808622725a52272=function(e){return p(s(e).queueMicrotask)},e.wbg.__wbg_queueMicrotask_ef0e86b0263a71ee=function(e){queueMicrotask(s(e))},e.wbg.__wbg_reject_b3fcf99063186ff7=function(e){return p(Promise.reject(s(e)))},e.wbg.__wbg_resolve_4851785c9c5f573d=function(e){return p(Promise.resolve(s(e)))},e.wbg.__wbg_set_37837023f3d740e8=function(e,t,n){s(e)[t>>>0]=A(n)},e.wbg.__wbg_set_3f1d0b984ed272ed=function(e,t,n){s(e)[A(t)]=A(n)},e.wbg.__wbg_set_65595bdd868b3009=function(e,t,n){s(e).set(s(t),n>>>0)},e.wbg.__wbg_set_8fc6bf8a5b1071d1=function(e,t,n){return p(s(e).set(s(t),s(n)))},e.wbg.__wbg_stack_0ed75d68575b0f3c=function(e,t){let n=w(s(t).stack,i.__wbindgen_export_0,i.__wbindgen_export_1),r=a;f().setInt32(e+4,r,!0),f().setInt32(e+0,n,!0)},e.wbg.__wbg_startTime_c051731d0a31602f=function(e){return s(e).startTime},e.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){let e=typeof global>"u"?null:global;return v(e)?0:p(e)},e.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){let e=typeof globalThis>"u"?null:globalThis;return v(e)?0:p(e)},e.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){let e=typeof self>"u"?null:self;return v(e)?0:p(e)},e.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){let e=typeof window>"u"?null:window;return v(e)?0:p(e)},e.wbg.__wbg_stringify_f7ed6987935b4a24=function(){return h((function(e){return p(JSON.stringify(s(e)))}),arguments)},e.wbg.__wbg_table_new=function(e){return p(P.__wrap(e))},e.wbg.__wbg_then_44b73946d2fb3e7d=function(e,t){return p(s(e).then(s(t)))},e.wbg.__wbg_then_48b406749878a531=function(e,t,n){return p(s(e).then(s(t),s(n)))},e.wbg.__wbg_toString_5285597960676b7b=function(e){return p(s(e).toString())},e.wbg.__wbg_trace_d12a9ac890a2cbb8=function(e,t,n,r){console.trace(s(e),s(t),s(n),s(r))},e.wbg.__wbg_trace_e758b839df8d34f1=function(e){console.trace(s(e))},e.wbg.__wbg_value_cd1ffa7b1ab794f1=function(e){return p(s(e).value)},e.wbg.__wbg_values_fcb8ba8c0aad8b58=function(e){return p(Object.values(s(e)))},e.wbg.__wbg_view_new=function(e){return p(R.__wrap(e))},e.wbg.__wbg_view_unwrap=function(e){return R.__unwrap(A(e))},e.wbg.__wbg_warn_4ca3906c248c47c4=function(e){console.warn(s(e))},e.wbg.__wbg_warn_aaf1f4664a035bd6=function(e,t,n,r){console.warn(s(e),s(t),s(n),s(r))},e.wbg.__wbindgen_as_number=function(e){return+s(e)},e.wbg.__wbindgen_bigint_from_i64=function(e){return p(e)},e.wbg.__wbindgen_bigint_from_u64=function(e){return p(BigInt.asUintN(64,e))},e.wbg.__wbindgen_bigint_get_as_i64=function(e,t){let n=s(t),r="bigint"==typeof n?n:void 0;f().setBigInt64(e+8,v(r)?BigInt(0):r,!0),f().setInt32(e+0,!v(r),!0)},e.wbg.__wbindgen_boolean_get=function(e){let t=s(e);return"boolean"==typeof t?t?1:0:2},e.wbg.__wbindgen_cb_drop=function(e){let t=A(e).original;return 1==t.cnt--&&(t.a=0,!0)},e.wbg.__wbindgen_closure_wrapper3202=function(e,t,n){let r=function(e,t,n,r){let _={a:e,b:t,cnt:1,dtor:n},o=function(){_.cnt++;let e=_.a;_.a=0;try{for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];return r(e,_.b,...n)}finally{0==--_.cnt?(i.__wbindgen_export_4.get(_.dtor)(e,_.b),x.unregister(_)):_.a=e}};return o.original=_,x.register(o,_,_),o}(e,t,471,j);return p(r)},e.wbg.__wbindgen_closure_wrapper377=function(e,t,n){let r=function(e,t,n,r){let _={a:e,b:t,cnt:1,dtor:n},o=function(){_.cnt++;try{for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return r(_.a,_.b,...t)}finally{0==--_.cnt&&(i.__wbindgen_export_4.get(_.dtor)(_.a,_.b),_.a=0,x.unregister(_))}};return o.original=_,x.register(o,_,_),o}(e,t,7,O);return p(r)},e.wbg.__wbindgen_debug_string=function(e,t){let n=w(I(s(t)),i.__wbindgen_export_0,i.__wbindgen_export_1),r=a;f().setInt32(e+4,r,!0),f().setInt32(e+0,n,!0)},e.wbg.__wbindgen_error_new=function(e,t){return p(new Error(m(e,t)))},e.wbg.__wbindgen_in=function(e,t){return s(e)in s(t)},e.wbg.__wbindgen_is_bigint=function(e){return"bigint"==typeof s(e)},e.wbg.__wbindgen_is_function=function(e){return"function"==typeof s(e)},e.wbg.__wbindgen_is_object=function(e){let t=s(e);return"object"==typeof t&&null!==t},e.wbg.__wbindgen_is_string=function(e){return"string"==typeof s(e)},e.wbg.__wbindgen_is_undefined=function(e){return void 0===s(e)},e.wbg.__wbindgen_jsval_eq=function(e,t){return s(e)===s(t)},e.wbg.__wbindgen_jsval_loose_eq=function(e,t){return s(e)==s(t)},e.wbg.__wbindgen_memory=function(){return p(i.memory)},e.wbg.__wbindgen_number_get=function(e,t){let n=s(t),r="number"==typeof n?n:void 0;f().setFloat64(e+8,v(r)?0:r,!0),f().setInt32(e+0,!v(r),!0)},e.wbg.__wbindgen_number_new=function(e){return p(e)},e.wbg.__wbindgen_object_clone_ref=function(e){return p(s(e))},e.wbg.__wbindgen_object_drop_ref=function(e){A(e)},e.wbg.__wbindgen_string_get=function(e,t){let n=s(t),r="string"==typeof n?n:void 0;var _=v(r)?0:w(r,i.__wbindgen_export_0,i.__wbindgen_export_1),o=a;f().setInt32(e+4,o,!0),f().setInt32(e+0,_,!0)},e.wbg.__wbindgen_string_new=function(e,t){return p(m(e,t))},e.wbg.__wbindgen_throw=function(e,t){throw new Error(m(e,t))},e}function C(e,t){return i=e.exports,F.__wbindgen_wasm_module=t,g=null,c=null,i}function T(e){if(void 0!==i)return i;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?({module:e}=e):console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));let t=q();return e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e)),C(new WebAssembly.Instance(e,t),e)}async function F(e){if(void 0!==i)return i;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?({module_or_path:e}=e):console.warn("using deprecated parameters for the initialization function; pass a single object instead"));let t=q();("string"==typeof e||"function"==typeof Request&&e instanceof Request||"function"==typeof URL&&e instanceof URL)&&(e=fetch(e));let{instance:n,module:r}=await async function(e,t){if("function"==typeof Response&&e instanceof Response){if("function"==typeof WebAssembly.instantiateStreaming)try{return await WebAssembly.instantiateStreaming(e,t)}catch(r){if("application/wasm"==e.headers.get("Content-Type"))throw r;console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r)}let n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}{let n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}(await e,t);return C(n,r)}var z=F;async function H(e,t,n,r){let _,i;async function o(){if(i?.readyState===e.CONNECTING||i?.readyState===e.OPEN)return void console.warn(`Already connected ${i.readyState}`);let[t,s,a]=function(){let e,t,n=new Promise(((n,r)=>{e=n,t=r}));return[e,n,t]}();i=new e(n,r),i.onopen=t,i.binaryType="arraybuffer",i.onerror=e=>{let t=e.message||"Generic Websocket Error";_.handle_error(t,o),a(t)},i.onclose=e=>{let t=`WebSocket closed ${e.code}`;_.handle_error(t,o),a(t)},i.onmessage=e=>{_.handle_response(e.data)},await s}return _=new t((async function(t){if(i.readyState===e.CLOSING||i.readyState===e.CLOSED){let e=`WebSocket transport error (${i.readyState})`;throw _.handle_error(e,o),new Error(e)}if(i.readyState===e.CONNECTING){let e=`WebSocket message dropped (${i.readyState})`;throw new Error(e)}{let e=t.slice().buffer;i.send(e)}}),(async function(){console.debug("Closing WebSocket"),i.close()})),await o(),await _.init(),_}async function D(e,t){let[n,r]=function(){let e,t,n=new Promise(((n,r)=>{e=n,t=r}));return[e,n,t]}();e.addEventListener("message",(function t(r){e.removeEventListener("message",t),n(null)})),e.onmessage=function(t){e.onmessage=function(){},n(null)},e.onmessageerror=console.error,e.postMessage({cmd:"init",args:[t]},{transfer:t instanceof WebAssembly.Module?[]:[t]}),await r}if(typeof WebAssembly>"u")throw new Error("WebAssembly not supported.");async function $(e){e instanceof Function&&(e=await e());try{return await async function(e){let t;"function"==typeof e?.then&&(e=await e),t=e instanceof Response?await WebAssembly.instantiateStreaming(e):"string"==typeof e?await WebAssembly.instantiateStreaming(fetch(e)):e instanceof ArrayBuffer?await WebAssembly.instantiate(e):e instanceof Uint8Array?await WebAssembly.instantiate(e.buffer):e;let n=t.instance.exports,[r]=WebAssembly.Module.customSections(t.module,"psp-runtime"),[_]=WebAssembly.Module.customSections(t.module,"psp-len"),i=new DataView(_).getUint32(0,!0),o=n.resize(r.byteLength);new Uint8Array(n.memory.buffer).set(new Uint8Array(r),o);let s=n.compile(r.byteLength,i);return new Uint8Array(n.memory.buffer).slice(s,i+s)}(e)}catch{return console.warn("Stage 0 wasm loading failed, skipping"),new Uint8Array(e)}}var V='"use strict";(()=>{var I=Object.defineProperty;var S=(s,t,r)=>t in s?I(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var f=(s,t,r)=>S(s,typeof t!="symbol"?t+"":t,r);var v=class{constructor(t){f(this,"poll_handle");f(this,"server");this.server=t}set_poll_handle(){return this.poll_handle=new Promise((t,r)=>setTimeout(()=>this.server.poll().then(t).catch(r).finally(()=>{this.poll_handle=void 0}))),this.poll_handle}async on_poll_request(){this.poll_handle?await this.poll_handle.then(()=>{if(!this.poll_handle)return this.set_poll_handle()}):await this.set_poll_handle()}},h=class{constructor(t,r){f(this,"clients");f(this,"server");f(this,"module");f(this,"on_poll_request");this.clients=new Map,this.module=t,this.on_poll_request=r?.on_poll_request,this.server=t._psp_new_server(r?.on_poll_request?1:0)}make_session(t){let r=this.module._psp_new_session(this.server);return this.clients.set(r,t),new P(this.module,this.server,r,this.clients,this.on_poll_request&&(()=>this.on_poll_request(this)))}async poll(){let t=this.module._psp_poll(this.server);await A(this.module,t,async r=>{await this.clients.get(r.client_id)(r.data)})}delete(){this.module._psp_delete_server(this.server)}},P=class{constructor(t,r,i,a,p){this.mod=t;this.server=r;this.client_id=i;this.client_map=a;this.on_poll_request=p}async handle_request(t){let r=await H(this.mod,t,async i=>this.mod._psp_handle_request(this.server,this.client_id,i,this.mod._psp_is_memory64()?BigInt(t.byteLength):t.byteLength));await A(this.mod,r,async i=>{await this.client_map.get(i.client_id)(i.data)}),this.on_poll_request?await this.on_poll_request():await this.poll()}async poll(){let t=this.mod._psp_poll(this.server);await A(this.mod,t,async r=>{r.client_id===0?console.error("Poll error"):await this.client_map.get(r.client_id)(r.data)})}close(){this.mod._psp_close_session(this.server,this.client_id)}};async function H(s,t,r){let i=s._psp_alloc(s._psp_is_memory64()?BigInt(t.byteLength):t.byteLength);s.HEAPU8.set(t,Number(i));let a=await r(i);return s._psp_free(i),a}async function A(s,t,r){let i=s._psp_is_memory64(),a=new DataView(s.HEAPU8.buffer,Number(t),i?12:8),p=a.getUint32(0,!0),u=i?a.getBigInt64(4,!0):a.getUint32(4,!0),e=new DataView(s.HEAPU8.buffer,Number(u),p*(i?16:12));try{for(let n=0;n<p;n++){let[o,l,y]=i?[e.getBigInt64(n*16,!0),e.getInt32(n*16+8,!0),e.getInt32(n*16+12,!0)]:[e.getInt32(n*12,!0),e.getInt32(n*12+4,!0),e.getInt32(n*12+8,!0)],c=new Uint8Array(s.HEAPU8.buffer,Number(o),l);await r({client_id:y,data:c})}}finally{for(let n=0;n<p;n++){let o=i?e.getBigInt64(n*16,!0):e.getInt32(n*12,!0);s._psp_free(o)}s._psp_free(i?BigInt(e.byteOffset):e.byteOffset),s._psp_free(i?BigInt(a.byteOffset):a.byteOffset)}}var q=console.log.bind(console),L=console.error.bind(console),N=new TextDecoder("utf8"),R=[null,[],[]];function j(s,t=0,r=NaN){for(var i=t+r,a=t;s[a]&&!(a>=i);)++a;return N.decode(s instanceof Uint8Array?s.subarray(t,a):new Uint8Array(s.slice(t,a)))}function E(s,t){var r=R[s];t===0||t===10?((s===1?q:L)(j(r,0)),r.length=0):r.push(t)}async function U(s){let t,r=!1,i,a={HaveOffsetConverter(){console.error("HaveOffsetConverter")},__syscall_ftruncate64(...e){console.error("__syscall_frtuncate64",e)},__syscall_getdents64(...e){console.error("__syscall_frtuncate64",e)},__syscall_unlinkat(...e){console.error("__syscall_frtuncate64",e)},__throw_exception_with_stack_trace(e){let n=new WebAssembly.Exception(t.__cpp_exception,[e],{traceStack:!0});throw n.message="Unexpected internal error",n},clock_time_get(e,n,o){if(r){if(o=o,o=Number(o),!(e==0||e==1||e==2||e==3))return 28;var l;e===0?l=Date.now():l=performance.now();let c=Math.round(l*1e3*1e3),_=new BigInt64Array(i.buffer);return _[o/8]=BigInt(c),0}else{if(o=o,o>>>=0,!(e==0||e==1||e==2||e==3))return 28;var l;e===0?l=Date.now():l=performance.now();var y=Math.round(l*1e6);let _=new BigInt64Array(i.buffer);return _[o>>>3]=BigInt(y),0}},emscripten_asm_const_int(...e){return 0},emscripten_notify_memory_growth(e){r?e=Number(e):(e=e,e>>>=0),e!=0&&console.error("abort")},environ_get(...e){return 0},environ_sizes_get(...e){return 0},fd_close(...e){return console.error("fd_close",e),0},fd_read(...e){return console.error("fd_read",e),0},fd_seek(...e){return console.error("fs_seek",e),0},fd_write(e,n,o,l){let y=new Uint8Array(i.buffer);if(r){n=Number(n),o=Number(o),l=Number(l);let c=0,_=new BigUint64Array(i.buffer);for(let b=0;b<o;b++){let w=Number(_[n/8]),d=Number(_[(n+8)/8]);n+=16;for(let m=0;m<d;m++)E(e,y[w+m]);c+=d}return _[l/8]=BigInt(c),0}else{n=n,o=o,l=l,n>>>=0,o>>>=0,l>>>=0;let c=0,_=new Uint32Array(i.buffer);for(let b=0;b<o;b++){let w=_[n>>>2>>>0],d=_[n+4>>>2>>>0];n+=8;for(let m=0;m<d;m++)E(e,y[w+m>>>0]);c+=d}return _[l>>>2>>>0]=c,0}},proc_exit(e){return console.error("proc_exit",e),0}},p=await s.instantiateWasm({env:a,wasi_snapshot_preview1:a},e=>{t=e.exports,r=!!t.psp_is_memory64(),i=e.exports.memory,t._initialize()}),u={};for(let[e,n]of Object.entries(p))u[`_${e}`]=n;return{...p,...u,get HEAPU8(){return new Uint8Array(i.buffer)}}}async function M(s){let t=await U({locateFile(r){return r},instantiateWasm:async(r,i)=>{r.env={...r.env,psp_stack_trace(){let p=Error().stack||"",e=new TextEncoder().encode(p),n=t._psp_alloc(t._psp_is_memory64()?BigInt(e.byteLength+1):e.byteLength+1);return t.HEAPU8.set(e,Number(n)),t.HEAPU8[Number(n)+e.byteLength]=0,n},psp_heap_size(){return t._psp_is_memory64()?BigInt(t.HEAPU8.buffer.byteLength):t.HEAPU8.buffer.byteLength}};let a=await WebAssembly.instantiate(s,r);return i(a.instance),a.instance.exports}});return t}var g,x;function B(s){let t=s.ports[0],r;t.addEventListener("message",async i=>{if(i.data.cmd==="init"){let a=i.data.id;if(!g){let p=await M(i.data.args[0]);g=new h(p,{on_poll_request:()=>x.on_poll_request()}),x=new v(g)}r=g.make_session(async p=>{let u=p.slice().buffer;t.postMessage(u,{transfer:[u]})}),t.postMessage({id:a})}else await r.handle_request(new Uint8Array(i.data))}),t.start()}self.addEventListener("connect",B);self.addEventListener("message",B);})();\n';function G(e,t){return{addEventListener:function(t,n){"message"===t&&e.push(n)},removeEventListener:function(t){let n=e.indexOf(t);n>-1&&e.splice(n,1)},postMessage:function(e,n){for(let r of t)r({data:e,ports:n})},location:{href:""}}}var J,K,Q,X=async function(){try{if(window.location.protocol.startsWith("file"))return console.warn("file:// protocol does not support Web Workers"),function(e){console.error("Running perspective in single-threaded mode");let t=[],n=[];return Function("const self = arguments[0];"+e)(G(t,n)),G(n,t)}(V);{let e=new Blob([V],{type:"application/javascript"}),t=URL.createObjectURL(e);return new Worker(t,{type:"module"})}}catch(e){console.error("Error instantiating engine",e)}};function Y(e,t){void 0===t&&(t=!1),J=e instanceof Uint8Array?Promise.resolve(e.buffer):e instanceof Response?Promise.resolve(e):e instanceof Promise?e:Promise.resolve(e),t||(J=J.then((e=>$(e).then((e=>e.buffer)))))}async function Z(e,t){void 0===t&&(t=!1);let n=t?e:await $(e);return await z({module_or_path:n}),await S(),_}function ee(e,t){void 0===t&&(t=!1),e instanceof Uint8Array?K=Z(e.buffer,t):e instanceof ArrayBuffer||e instanceof Response||e instanceof Promise?K=Z(e,t):e instanceof Object&&(K=Promise.resolve(e))}function te(){let e=customElements.get("perspective-viewer");if(e)K=Promise.resolve(e.__wasm_module__);else if(void 0===K)throw new Error("Missing perspective-client.wasm");return K}async function ne(e){return await async function(e,t){let{Client:n}=await e;return await H(WebSocket,n,t)}(te(),e)}async function re(e){return typeof e>"u"&&(e=void 0===Q?X():Q()),await async function(e,t,n){let r,[_,i]=await Promise.all([t,n]),{Client:o}=await e;if(typeof SharedWorker<"u"&&i instanceof SharedWorker)r=i.port;else{let e=new MessageChannel;i.postMessage(null,[e.port2]),r=e.port1}let s=new o((async e=>{let t=e.slice().buffer;r.postMessage(t,{transfer:[t]})}),(async()=>{console.debug("Closing WebWorker"),r.close()}));return await D(r,_),r.addEventListener("message",(e=>{s.handle_response(e.data)})),await s.init(),s}(te(),function(){if(void 0===J)throw new Error("Missing perspective-server.wasm");return J.then((e=>e instanceof WebAssembly.Module?e:e.slice(0)))}(),e)}var _e={websocket:ne,worker:re,init_client:ee,init_server:Y}}}]);