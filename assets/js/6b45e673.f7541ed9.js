"use strict";(self.webpackChunk_finos_perspective_docs=self.webpackChunk_finos_perspective_docs||[]).push([[423],{5318:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>v});var a=n(7378);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=p(n),u=i,v=c["".concat(l,".").concat(u)]||c[u]||m[u]||r;return n?a.createElement(v,o(o({ref:t},d),{},{components:n})):a.createElement(v,o({ref:t},d))}));function v(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[c]="string"==typeof e?e:i,o[1]=s;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6207:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>p});var a=n(2685),i=(n(7378),n(5318));const r={id:"js",title:"JavaScript User Guide"},o=void 0,s={unversionedId:"js",id:"js",title:"JavaScript User Guide",description:"Perspective's JavaScript library offers a configurable UI powered by a fast",source:"@site/docs/js.md",sourceDirName:".",slug:"/js",permalink:"/docs/js",draft:!1,tags:[],version:"current",frontMatter:{id:"js",title:"JavaScript User Guide"},sidebar:"tutorialSidebar",next:{title:"Python User Guide",permalink:"/docs/python"}},l={},p=[{value:"Installation",id:"installation",level:2},{value:"From NPM (Node.js)",id:"from-npm-nodejs",level:3},{value:"From NPM (Browser)",id:"from-npm-browser",level:3},{value:"Via bundlers (optional)",id:"via-bundlers-optional",level:4},{value:"Webpack",id:"webpack",level:5},{value:"<code>esbuild</code>",id:"esbuild",level:5},{value:"From CDN",id:"from-cdn",level:3},{value:"Module Structure",id:"module-structure",level:2},{value:"Which modules should I import?",id:"which-modules-should-i-import",level:3},{value:"<code>perspective</code> data engine library",id:"perspective-data-engine-library",level:2},{value:"Importing in the browser",id:"importing-in-the-browser",level:3},{value:"Instantiating a new <code>worker()</code>",id:"instantiating-a-new-worker",level:4},{value:"Importing in Node.js",id:"importing-in-nodejs",level:3},{value:"Serializing data using <code>to_*()</code>",id:"serializing-data-using-to_",level:3},{value:"Deleting a <code>table()</code> or <code>view()</code>",id:"deleting-a-table-or-view",level:3},{value:"<code>perspective-viewer</code> web component library",id:"perspective-viewer-web-component-library",level:2},{value:"Theming",id:"theming",level:3},{value:"Loading data into <code>&lt;perspective-viewer&gt;</code>",id:"loading-data-into-perspective-viewer",level:3},{value:"Sharing a <code>table()</code> between multiple <code>perspective-viewer</code>s",id:"sharing-a-table-between-multiple-perspective-viewers",level:3},{value:"Server-only via <code>WebSocketServer()</code> and Node.js",id:"server-only-via-websocketserver-and-nodejs",level:3},{value:"Server-only via <code>perspective-python</code> and Tornado",id:"server-only-via-perspective-python-and-tornado",level:3},{value:"Persistent <code>&lt;perspective-viewer&gt;</code> configuration via <code>save()</code>/<code>restore()</code>.",id:"persistent-perspective-viewer-configuration-via-saverestore",level:3},{value:"Serializing and deserializing the viewer state",id:"serializing-and-deserializing-the-viewer-state",level:4},{value:"Updating individual properties",id:"updating-individual-properties",level:4},{value:"Update events",id:"update-events",level:3},{value:"Click events",id:"click-events",level:3}],d={toc:p};function c(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Perspective's JavaScript library offers a configurable UI powered by a fast\nstreaming data engine. Developers are able to pick and choose the modules they\nrequire for their use case, and users are presented with a clean user interface\nthrough which to analyze data."),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://github.com/finos/perspective/tree/master/examples"},"More Examples")," are\navailable on GitHub."),(0,i.kt)("h2",{id:"installation"},"Installation"),(0,i.kt)("p",null,"Perspective releases contain several different builds for easy usage in most\nenvironments, either via NPM with or without a bundler, or via ",(0,i.kt)("inlineCode",{parentName:"p"},"<script>"),' tag\nfrom a CDN or asset server of your choice. Depending on which build you choose,\ndue to the presence of both WebAssembly and WebWorkers, the installation process\nfor Perspective may be somewhat more complex than most "pure" Javascript\nlibraries if you want to achieve optimal initial load-time performance.'),(0,i.kt)("h3",{id:"from-npm-nodejs"},"From NPM (Node.js)"),(0,i.kt)("p",null,"To use Perspective from a Node.js server, simply install via NPM."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ yarn add @finos/perspective\n")),(0,i.kt)("h3",{id:"from-npm-browser"},"From NPM (Browser)"),(0,i.kt)("p",null,"For using Perspective as a dependency in a ",(0,i.kt)("inlineCode",{parentName:"p"},"webpack")," (or other bundler) app,\nPerspective's WebAssembly data engine is available via NPM in the same package,\n",(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective"),". For the ",(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective-viewer")," UI, a few additional\npackages are required:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"$ yarn add @finos/perspective @finos/perspective-viewer @finos/perspective-viewer-d3fc @finos/perspective-viewer-datagrid\n")),(0,i.kt)("p",null,"Perspective requires the browser to have access to Perspective's ",(0,i.kt)("inlineCode",{parentName:"p"},".worker.js"),"\nand ",(0,i.kt)("inlineCode",{parentName:"p"},".wasm")," assets ",(0,i.kt)("em",{parentName:"p"},"in addition")," to the bundled ",(0,i.kt)("inlineCode",{parentName:"p"},".js")," scripts. By default,\nPerspective ",(0,i.kt)("a",{href:"https://github.com/finos/perspective/pull/870"},"inlines"),"\nthese assets into the ",(0,i.kt)("inlineCode",{parentName:"p"},".js")," scripts, and delivers them in one file. This has no\nruntime performance impact, but does increase asset load time. Most apps should\nmake use of ",(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective-webpack-plugin")," which will package these files\ncorrectly form your existing Webpack configuration."),(0,i.kt)("h4",{id:"via-bundlers-optional"},"Via bundlers (optional)"),(0,i.kt)("p",null,"When importing ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective")," from NPM modules for a browser application, you may\nchoose to use a provided bundler plugin to manage the ",(0,i.kt)("inlineCode",{parentName:"p"},".worker.js")," and ",(0,i.kt)("inlineCode",{parentName:"p"},".wasm"),"\nassets for you. Doing so will improve your application's initial load\nperformance, as the plugin-assisted bundle version of Perspective:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Downloads ",(0,i.kt)("inlineCode",{parentName:"li"},".wasm")," and ",(0,i.kt)("inlineCode",{parentName:"li"},".js")," assets in parallel."),(0,i.kt)("li",{parentName:"ul"},"Compiles ",(0,i.kt)("inlineCode",{parentName:"li"},".wasm")," incrementally via\n",(0,i.kt)("a",{parentName:"li",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/WebAssembly/instantiateStreaming"},"streaming instantiation"),"."),(0,i.kt)("li",{parentName:"ul"},"overall bundle size is ~20% smaller (due to bas64 encoding overhead).")),(0,i.kt)("p",null,"Perspective comes with bundler plugins for:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Webpack via ",(0,i.kt)("inlineCode",{parentName:"li"},"@finos/perspective-webpack-plugin")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"esbuild")," via ",(0,i.kt)("inlineCode",{parentName:"li"},"@finos/perspective-esbuild-plugin"))),(0,i.kt)("h5",{id:"webpack"},"Webpack"),(0,i.kt)("p",null,"The plugin handles downloading and packaging Perspective's additional assets,\nand is easy to set up in your ",(0,i.kt)("inlineCode",{parentName:"p"},"webpack.config"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const PerspectivePlugin = require("@finos/perspective-webpack-plugin");\n\nmodule.exports = {\n    entry: "./in.js",\n    output: {\n        filename: "out.js",\n        path: "build",\n    },\n    plugins: [new PerspectivePlugin()],\n};\n')),(0,i.kt)("h5",{id:"esbuild"},(0,i.kt)("inlineCode",{parentName:"h5"},"esbuild")),(0,i.kt)("p",null,"Applications bundled with ",(0,i.kt)("inlineCode",{parentName:"p"},"esbuild")," can make use of the\n",(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective-esbuild-plugin")," module. A full example can be found in the\nrepo under\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/finos/perspective/tree/master/examples/esbuild-example"},(0,i.kt)("inlineCode",{parentName:"a"},"examples/esbuild-example")),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const esbuild = require("esbuild");\nconst {\n    PerspectiveEsbuildPlugin,\n} = require("@finos/perspective-esbuild-plugin");\n\nesbuild.build({\n    entryPoints: ["src/index.js"],\n    plugins: [PerspectiveEsbuildPlugin()],\n    format: "esm",\n    bundle: true,\n    loader: {\n        ".ttf": "file",\n    },\n});\n')),(0,i.kt)("p",null,"When bundling via ",(0,i.kt)("inlineCode",{parentName:"p"},"esbuild"),", you must also"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Use the ",(0,i.kt)("inlineCode",{parentName:"li"},'type="module"')," attribute in your app's ",(0,i.kt)("inlineCode",{parentName:"li"},"<script>")," tag, as this\nbuild mode is only supported via ES modules."),(0,i.kt)("li",{parentName:"ul"},"Use the direct imports for the ",(0,i.kt)("inlineCode",{parentName:"li"},"esm")," versions Perspective, specifically\n",(0,i.kt)("inlineCode",{parentName:"li"},"@finos/perspective/dist/esm/perspective.js")," and\n",(0,i.kt)("inlineCode",{parentName:"li"},"@finos/perspective-viewer/dist/esm/perspective-viewer.js"))),(0,i.kt)("h3",{id:"from-cdn"},"From CDN"),(0,i.kt)("p",null,"Perspective can be loaded directly from most CDNs, such as\n",(0,i.kt)("a",{parentName:"p",href:"https://www.jsdelivr.com/package/npm/@finos/perspective-viewer"},"jsdelivr.com"),",\nwhich is the easiest way to get started with Perspective in the browser, and\nperfect for spinning up quick instances of ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective-viewer")," without\ninstalling or bundling."),(0,i.kt)("p",null,"While CDNs are great for development builds and small apps, for production usage\nyou should incorporate Perspective into your application with a bundler like\n",(0,i.kt)("inlineCode",{parentName:"p"},"Webpack"),", described above."),(0,i.kt)("p",null,"This build separates out Perspective's JavaScript, WebAssembly and various\nassets into individual files, allowing the browser to load them lazily, in\nparallel or not at all if needed. To use this build, you must include the\nperspective asset files in a script tag with the ",(0,i.kt)("inlineCode",{parentName:"p"},'type="module"')," attribute set."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<script\n    type="module"\n    src="https://cdn.jsdelivr.net/npm/@finos/perspective/dist/cdn/perspective.js"\n><\/script>\n<script\n    type="module"\n    src="https://cdn.jsdelivr.net/npm/@finos/perspective-viewer/dist/cdn/perspective-viewer.js"\n><\/script>\n<script\n    type="module"\n    src="https://cdn.jsdelivr.net/npm/@finos/perspective-viewer-datagrid/dist/cdn/perspective-viewer-datagrid.js"\n><\/script>\n<script\n    type="module"\n    src="https://cdn.jsdelivr.net/npm/@finos/perspective-viewer-d3fc/dist/cdn/perspective-viewer-d3fc.js"\n><\/script>\n\n<link\n    rel="stylesheet"\n    crossorigin="anonymous"\n    href="https://cdn.jsdelivr.net/npm/@finos/perspective-viewer/dist/css/pro.css"\n/>\n')),(0,i.kt)("p",null,"When using the ESM build, there is no global ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective")," symbol, so you must\nimport the ",(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective")," module in a ",(0,i.kt)("inlineCode",{parentName:"p"},'type="module"')," script as well:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<script type="module">\n    import perspective from "https://cdn.jsdelivr.net/npm/@finos/perspective/dist/cdn/perspective.js";\n\n    const worker = perspective.worker();\n    const table = agent.table({ x: [1, 2, 3, 4, 5] });\n    document.querySelector("perspective-viewer").load(table);\n<\/script>\n')),(0,i.kt)("h2",{id:"module-structure"},"Module Structure"),(0,i.kt)("p",null,"Perspective is designed for flexibility, allowing developers to pick and choose\nwhich modules they need for their specific use case. The main modules are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective"),(0,i.kt)("br",{parentName:"p"}),"\n","The data engine library, as both a browser ES6 and Node.js module. Provides\na WebAssembly, WebWorker (browser) and Process (node.js) runtime.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective-viewer"),(0,i.kt)("br",{parentName:"p"}),"\n","A user-configurable visualization widget, bundled as a\n",(0,i.kt)("a",{parentName:"p",href:"https://www.webcomponents.org/introduction"},"Web Component"),". This module\nincludes the core data engine module as a dependency."))),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," by itself only implements a trivial debug renderer, which\nprints the currently configured ",(0,i.kt)("inlineCode",{parentName:"p"},"view()")," as a CSV. Plugin modules for popular\nJavaScript libraries, such as ",(0,i.kt)("a",{parentName:"p",href:"https://d3fc.io/"},"d3fc"),", are packaged separately\nand must be imported individually."),(0,i.kt)("p",null,"Perspective offers these plugin modules:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective-viewer-datagrid"),(0,i.kt)("br",{parentName:"p"}),"\n","A custom high-performance data-grid component based on HTML ",(0,i.kt)("inlineCode",{parentName:"p"},"<table>"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective-viewer-d3fc"),(0,i.kt)("br",{parentName:"p"}),"\n","A ",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," plugin for the ",(0,i.kt)("a",{parentName:"p",href:"https://d3fc.io"},"d3fc")," charting\nlibrary."))),(0,i.kt)("p",null,"When imported after ",(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective-viewer"),", the plugin modules will\nregister themselves automatically, and the renderers they export will be\navailable in the ",(0,i.kt)("inlineCode",{parentName:"p"},"plugin")," dropdown in the ",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," UI."),(0,i.kt)("h3",{id:"which-modules-should-i-import"},"Which modules should I import?"),(0,i.kt)("p",null,"Depending on your requirements, you may need just one, or all, Perspective\nmodules. Here are some basic guidelines to help you decide what is most\nappropriate for your project:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"For Perspective's high-performance streaming data engine (in WebAssembly),\nor for a purely Node.js based application, import:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"@finos/perspective"),", as detailed ",(0,i.kt)("a",{parentName:"li",href:"#perspective-library"},"here")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"For Perspective as a simple, browser-based data visualization widget, you\nwill need to import:"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"@finos/perspective"),", detailed ",(0,i.kt)("a",{parentName:"li",href:"#perspective-library"},"here")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"@finos/perspective-viewer"),", detailed\n",(0,i.kt)("a",{parentName:"li",href:"#perspective-viewer-web-component"},"here")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"@finos/perspective-viewer-datagrid")," for data grids"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"@finos/perspective-viewer-d3fc")," for charting"))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"For more complex cases, such as\n",(0,i.kt)("a",{parentName:"p",href:"#sharing-a-table-between-multiple-perspective-viewers"},"sharing tables between viewers"),"\nand\n",(0,i.kt)("a",{parentName:"p",href:"#remote-perspective-via-workerhost"},"binding a viewer to a remote view in Node.js"),",\nyou will likely need all Perspective modules."))),(0,i.kt)("h2",{id:"perspective-data-engine-library"},(0,i.kt)("inlineCode",{parentName:"h2"},"perspective")," data engine library"),(0,i.kt)("p",null,"As a library, ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective")," provides a suite of streaming pivot, aggregate,\nfilter and sort operations for tabular data. The engine can be instantiated in\nprocess or in a Web Worker (browser only); in both cases, ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective")," exports\na nearly identical API."),(0,i.kt)("p",null,"It exports Perspective's data interfaces:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"table()"),": an interface over a single dataset, used to input static and\nstreaming data into Perspective.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"In the browser, ",(0,i.kt)("inlineCode",{parentName:"li"},"table()"),"s live in a Web Worker to isolate their runtime\nfrom the renderer."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"view()"),": a continuous query of a ",(0,i.kt)("inlineCode",{parentName:"li"},"table()"),", used to read data and calculate\nanalytics from a ",(0,i.kt)("inlineCode",{parentName:"li"},"table()"),".",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"view()"),"s also live in a Web Worker when used in a browser."),(0,i.kt)("li",{parentName:"ul"},"A single ",(0,i.kt)("inlineCode",{parentName:"li"},"table()")," may have many ",(0,i.kt)("inlineCode",{parentName:"li"},"view()"),"s attached at once.")))),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective")," also exports process management functions, such as\n",(0,i.kt)("inlineCode",{parentName:"p"},"worker()")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"websocket()")," (in the browser) and ",(0,i.kt)("inlineCode",{parentName:"p"},"WebSocketServer()")," (in\nNode.js). See the ",(0,i.kt)("a",{parentName:"p",href:"/docs/obj/perspective"},"API documentation")," for a complete\nreference on all exported methods. This module is a dependency of\n",(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective-viewer"),", and is not needed if you only intend to use\n",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," to visualize simple data."),(0,i.kt)("h3",{id:"importing-in-the-browser"},"Importing in the browser"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"perspective")," can be imported as an ES6 module and/or ",(0,i.kt)("inlineCode",{parentName:"p"},"require")," syntax if you're\nusing a bundler such as Webpack (and the ",(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective-webpack-plugin"),"):"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'import perspective from "@finos/perspective";\n')),(0,i.kt)("p",null,"or"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const perspective = require("@finos/perspective");\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective")," also comes with a pre-built bundle which exports the global\n",(0,i.kt)("inlineCode",{parentName:"p"},"perspective")," module name in vanilla JavaScript, when e.g. importing\n",(0,i.kt)("a",{parentName:"p",href:"#from-cdn"},"via a CDN"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<script src="@finos/perspective"><\/script>\n')),(0,i.kt)("p",null,"... or as a module:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<script type="module" src="@finos/perspective/dist/cdn/perspective.js"><\/script>\n')),(0,i.kt)("h4",{id:"instantiating-a-new-worker"},"Instantiating a new ",(0,i.kt)("inlineCode",{parentName:"h4"},"worker()")),(0,i.kt)("p",null,"Once imported, you'll need to instantiate a ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective")," engine via the\n",(0,i.kt)("inlineCode",{parentName:"p"},"worker()")," method. This will create a new Web Worker (browser) or Process\n(Node.js) and load the WebAssembly binary; all calculation and data accumulation\nwill occur in this separate process."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"const worker = perspective.worker();\n")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"worker")," symbol will expose the full ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective")," API for one managed Web\nWorker process. You are free to create as many as your browser supports, but be\nsure to keep track of the ",(0,i.kt)("inlineCode",{parentName:"p"},"worker")," instances themselves, as you'll need them to\ninteract with your data in each instance."),(0,i.kt)("h3",{id:"importing-in-nodejs"},"Importing in Node.js"),(0,i.kt)("p",null,"The Node.js runtime for the ",(0,i.kt)("inlineCode",{parentName:"p"},"@finos/perspective")," module runs in-process by\ndefault and does not implement a ",(0,i.kt)("inlineCode",{parentName:"p"},"child_process")," interface. Hence, there is no\n",(0,i.kt)("inlineCode",{parentName:"p"},"worker()")," method, and the module object itself directly exports the full\n",(0,i.kt)("inlineCode",{parentName:"p"},"perspective")," API."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const perspective = require("@finos/perspective");\n')),(0,i.kt)("p",null,"In Node.js, perspective does not run in a WebWorker (as this API does not exist\nin Node.js), so no need to call the ",(0,i.kt)("inlineCode",{parentName:"p"},".worker()")," factory function - the\n",(0,i.kt)("inlineCode",{parentName:"p"},"perspective")," library exports the functions directly and run synchronously in\nthe main process."),(0,i.kt)("h3",{id:"serializing-data-using-to_"},"Serializing data using ",(0,i.kt)("inlineCode",{parentName:"h3"},"to_*()")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"view()")," allows for serialization of data to the user through the\n",(0,i.kt)("inlineCode",{parentName:"p"},"to_json()"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"to_columns()"),", ",(0,i.kt)("inlineCode",{parentName:"p"},"to_csv()"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"to_arrow()")," methods. These methods\nreturn a ",(0,i.kt)("inlineCode",{parentName:"p"},"promise")," for the calculated data:"),(0,i.kt)("p",null,"Via ",(0,i.kt)("inlineCode",{parentName:"p"},"Promise")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"// an array of objects representing each row\nview.to_json().then((json) => console.log(json));\n\n// an object of arrays representing each column\nview.to_columns().then((json) => console.log(json));\n\n// a CSV-formatted string\nview.to_csv().then((csv) => console.log(csv));\n\n// an Arrow binary serialized to ArrayBuffer\nview.to_arrow().then((arrow) => console.log(arrow));\n")),(0,i.kt)("p",null,"Via ES6 ",(0,i.kt)("inlineCode",{parentName:"p"},"await"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"async")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"async function print_data() {\n    console.log(await view.to_json());\n    console.log(await view.to_columns());\n    console.log(await view.to_csv());\n    console.log(await view.to_arrow());\n}\n")),(0,i.kt)("h3",{id:"deleting-a-table-or-view"},"Deleting a ",(0,i.kt)("inlineCode",{parentName:"h3"},"table()")," or ",(0,i.kt)("inlineCode",{parentName:"h3"},"view()")),(0,i.kt)("p",null,"Unlike standard JavaScript objects, Perspective objects such as ",(0,i.kt)("inlineCode",{parentName:"p"},"table()")," and\n",(0,i.kt)("inlineCode",{parentName:"p"},"view()")," store their associated data in the WebAssembly heap. Because of this,\nas well as the current lack of a hook into the JavaScript runtime's garbage\ncollector from WebAssembly, the memory allocated to these Perspective objects\ndoes not automatically get cleaned up when the object falls out of scope."),(0,i.kt)("p",null,"In order to prevent memory leaks and reclaim the memory associated with a\nPerspective ",(0,i.kt)("inlineCode",{parentName:"p"},"table()")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"view()"),", you must call the ",(0,i.kt)("inlineCode",{parentName:"p"},"delete()")," method:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"await view.delete();\n\n// This method will throw an exception if there are still `view()`s depending\n// on this `table()`!\nawait table.delete();\n")),(0,i.kt)("h2",{id:"perspective-viewer-web-component-library"},(0,i.kt)("inlineCode",{parentName:"h2"},"perspective-viewer")," web component library"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," provides a complete graphical UI for configuring the\n",(0,i.kt)("inlineCode",{parentName:"p"},"perspective")," library and formatting its output to the provided visualization\nplugins."),(0,i.kt)("p",null,"If you are using ",(0,i.kt)("inlineCode",{parentName:"p"},"webpack")," or another bundler which supports ES6 modules, you\nonly need to import the ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective-viewer")," libraries somewhere in your\napplication - these modules export nothing, but rather register the components\nfor use within your site's regular HTML:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'import "@finos/perspective-viewer";\nimport "@finos/perspective-viewer-datagrid";\nimport "@finos/perspective-viewer-d3fc";\n')),(0,i.kt)("p",null,"Once imported, the ",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," Web Component will be available in any\nstandard HTML on your site. A simple example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<perspective-viewer id="view1"></perspective-viewer>\n')),(0,i.kt)("p",null,"or"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const viewer = document.createElement("perspective-viewer");\n')),(0,i.kt)("h3",{id:"theming"},"Theming"),(0,i.kt)("p",null,"Theming is supported in ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective-viewer")," and its accompanying plugins. A\nnumber of themes come bundled with ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective-viewer"),"; you can import any of\nthese themes directly into your app, and the ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective-viewer"),"s will be\nthemed accordingly:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'// Themes based on Thought Merchants\'s Prospective design\nimport "@finos/perspective-viewer/dist/css/pro.css";\nimport "@finos/perspective-viewer/dist/css/pro-dark.css";\n\n// Other themes\nimport "@finos/perspective-viewer/dist/css/solarized.css";\nimport "@finos/perspective-viewer/dist/css/solarized-dark.css";\nimport "@finos/perspective-viewer/dist/css/monokai.css";\nimport "@finos/perspective-viewer/dist/css/vaporwave.css";\n')),(0,i.kt)("p",null,"Alternatively, you may use ",(0,i.kt)("inlineCode",{parentName:"p"},"themes.css"),", which bundles all default themes"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'import "@finos/perspective-viewer/dist/css/themes.css";\n')),(0,i.kt)("p",null,"If you choose not to bundle the themes yourself, they are available through\n",(0,i.kt)("a",{parentName:"p",href:"https://cdn.jsdelivr.net/npm/@finos/perspective-viewer/dist/css/"},"CDN"),". These\ncan be directly linked in your HTML file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<link\n    rel="stylesheet"\n    crossorigin="anonymous"\n    href="https://cdn.jsdelivr.net/npm/@finos/perspective-viewer/dist/css/pro.css"\n/>\n')),(0,i.kt)("p",null,"Note the ",(0,i.kt)("inlineCode",{parentName:"p"},'crossorigin="anonymous"')," attribute. When including a theme from a\ncross-origin context, this attribute may be required to allow\n",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," to detect the theme. If this fails, additional themes are\nadded to the ",(0,i.kt)("inlineCode",{parentName:"p"},"document")," after ",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," init, or for any other\nreason theme auto-detection fails, you may manually inform\n",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," of the available theme names with the ",(0,i.kt)("inlineCode",{parentName:"p"},".resetThemes()"),"\nmethod."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'// re-auto-detect themes\nviewer.resetThemes();\n\n// Set available themes explicitly (they still must be imported as CSS!)\nviewer.resetThemes(["Pro Light", "Pro Dark"]);\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," will default to the first loaded theme when initialized.\nYou may override this via ",(0,i.kt)("inlineCode",{parentName:"p"},".restore()"),", or provide an initial theme by setting\nthe ",(0,i.kt)("inlineCode",{parentName:"p"},"theme")," attribute:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<perspective-viewer theme="Pro Light"></perspective-viewer>\n')),(0,i.kt)("p",null,"or"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const viewer = document.querySelector("perspective-viewer");\nviewer.restore({ theme: "Pro Dark" });\n')),(0,i.kt)("h3",{id:"loading-data-into-perspective-viewer"},"Loading data into ",(0,i.kt)("inlineCode",{parentName:"h3"},"<perspective-viewer>")),(0,i.kt)("p",null,"Data can be loaded into ",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," in the form of a ",(0,i.kt)("inlineCode",{parentName:"p"},"Table()")," or a\n",(0,i.kt)("inlineCode",{parentName:"p"},"Promise<Table>")," via the ",(0,i.kt)("inlineCode",{parentName:"p"},"load()")," method."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"// Create a new worker, then a new table promise on that worker.\nconst table = await perspective.worker().table(data);\n\n// Bind a viewer element to this table.\nviewer.load(table);\n")),(0,i.kt)("h3",{id:"sharing-a-table-between-multiple-perspective-viewers"},"Sharing a ",(0,i.kt)("inlineCode",{parentName:"h3"},"table()")," between multiple ",(0,i.kt)("inlineCode",{parentName:"h3"},"perspective-viewer"),"s"),(0,i.kt)("p",null,"Multiple ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective-viewer"),"s can share a ",(0,i.kt)("inlineCode",{parentName:"p"},"table()")," by passing the ",(0,i.kt)("inlineCode",{parentName:"p"},"table()"),"\ninto the ",(0,i.kt)("inlineCode",{parentName:"p"},"load()")," method of each viewer. Each ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective-viewer")," will update\nwhen the underlying ",(0,i.kt)("inlineCode",{parentName:"p"},"table()")," is updated, but ",(0,i.kt)("inlineCode",{parentName:"p"},"table.delete()")," will fail until\nall ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective-viewer")," instances referencing it are also deleted:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const viewer1 = document.getElementById("viewer1");\nconst viewer2 = document.getElementById("viewer2");\n\n// Create a new WebWorker\nconst worker = perspective.worker();\n\n// Create a table in this worker\nconst table = await worker.table(data);\n\n// Load the same table in 2 different <perspective-viewer> elements\nviewer1.load(table);\nviewer2.load(table);\n\n// Both `viewer1` and `viewer2` will reflect this update\ntable.update([{ x: 5, y: "e", z: true }]);\n')),(0,i.kt)("h3",{id:"server-only-via-websocketserver-and-nodejs"},"Server-only via ",(0,i.kt)("inlineCode",{parentName:"h3"},"WebSocketServer()")," and Node.js"),(0,i.kt)("p",null,"For exceptionally large datasets, a ",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," can be bound to a\n",(0,i.kt)("inlineCode",{parentName:"p"},"perspective.table()")," instance running in Node.js remotely, rather than creating\none in a Web Worker and downloading the entire data set. This trades off network\nbandwidth and server resource requirements for a smaller browser memory and CPU\nfootprint."),(0,i.kt)("p",null,"In Node.js:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const { WebSocketServer, table } = require("@finos/perspective");\nconst fs = require("fs");\n\n// Start a WS/HTTP host on port 8080.  The `assets` property allows\n// the `WebSocketServer()` to also serves the file structure rooted in this\n// module\'s directory.\nconst host = new WebSocketServer({ assets: [__dirname], port: 8080 });\n\n// Read an arrow file from the file system and host it as a named table.\nconst arr = fs.readFileSync(__dirname + "/superstore.lz4.arrow");\ntable(arr).then((table) => {\n    host.host_table("table_one", table);\n});\n')),(0,i.kt)("p",null,"In the browser:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const elem = document.getElementsByTagName("perspective-viewer")[0];\n\n// Bind to the server\'s worker instead of instantiating a Web Worker.\nconst websocket = perspective.websocket(\n    window.location.origin.replace("http", "ws")\n);\n\n// Bind the viewer to the preloaded data source.  `table` and `view` objects\n// live on the server.\nconst server_table = await websocket.open_table("table_one");\nelem.load(server_table);\n\n// Or load data from a table using a view. The browser now also has a copy of\n// this view in its own `table`, as well as its updates transferred to the\n// browser using Apache Arrow.\nconst worker = perspective.worker();\nconst server_view = await server_table.view();\nconst client_table = worker.table(server_view);\nelem.load(client_table);\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," instances bound in this way are otherwise no different\nthan ",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>"),"s which rely on a Web Worker, and can even share a\nhost application with Web Worker-bound ",(0,i.kt)("inlineCode",{parentName:"p"},"table()"),"s. The same ",(0,i.kt)("inlineCode",{parentName:"p"},"promise"),"-based API\nis used to communicate with the server-instantiated ",(0,i.kt)("inlineCode",{parentName:"p"},"view()"),", only in this case\nit is over a websocket."),(0,i.kt)("h3",{id:"server-only-via-perspective-python-and-tornado"},"Server-only via ",(0,i.kt)("inlineCode",{parentName:"h3"},"perspective-python")," and Tornado"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"perspective-python")," is designed to be cross-compatible with the ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective"),"\nand ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective-viewer")," libraries. Similar to ",(0,i.kt)("inlineCode",{parentName:"p"},"WebsocketServer")," in Node.js,\n",(0,i.kt)("inlineCode",{parentName:"p"},"perspective-python")," runs on the server without any memory limits, reducing\nresource usage in the browser. For more detailed documentation on the Python\nAPI, see the ",(0,i.kt)("a",{parentName:"p",href:"/docs/python"},"Python user guide")," or the\n",(0,i.kt)("a",{parentName:"p",href:"/docs/obj/perspective-python"},"Python API documentation"),"."),(0,i.kt)("p",null,"The simplest implementation uses Tornado as a websocket server in Python,\nhosting an endpoint at which a ",(0,i.kt)("inlineCode",{parentName:"p"},"table()")," can be accessed:"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},(0,i.kt)("em",{parentName:"em"},"server.py"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},'from perspective import Table, PerspectiveManager, PerspectiveTornadoHandler\n\n# Create an instance of PerspectiveManager, and host a Table\nMANAGER = PerspectiveManager()\nTABLE = Table(large_dataset)\n\n# The Table is exposed at `localhost:8888/websocket` with the name `data_source`\nMANAGER.host_table("data_source", TABLE)\n\napp = tornado.web.Application([\n    (r"/", MainHandler),\n    # create a websocket endpoint that the client JavaScript can access\n    (r"/websocket", PerspectiveTornadoHandler, {"manager": MANAGER, "check_origin": True})\n])\n\n# Start the Tornado server\napp.listen(8888)\nloop = tornado.ioloop.IOLoop.current()\nloop.start()\n')),(0,i.kt)("p",null,"The JavaScript implementation of this does not require Webpack or any bundler,\nand can be achieved in a single HTML file:"),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},(0,i.kt)("em",{parentName:"em"},"index.html"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-html"},'<perspective-viewer id="viewer" editable></perspective-viewer>\n\n<script>\n    window.addEventListener("DOMContentLoaded", async function () {\n        // Create a client that expects a Perspective server\n        // to accept connections at the specified URL.\n        const websocket = perspective.websocket(\n            "ws://localhost:8888/websocket"\n        );\n\n        /* `table` is a proxy for the `Table` we created on the server.\n\n        All operations that are possible through the JavaScript API are possible\n        on the Python API as well, thus calling `view()`, `schema()`, `update()`\n        etc. on `const table` will pass those operations to the Python `Table`,\n        execute the commands, and return the result back to JavaScript.*/\n        const table = websocket.open_table("data_source_one");\n\n        // Load this in the `<perspective-viewer>`.\n        document.getElementById("viewer").load(table);\n    });\n<\/script>\n')),(0,i.kt)("p",null,"Any operation performed on the ",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," instance or on ",(0,i.kt)("inlineCode",{parentName:"p"},"table"),"\nwill be forwarded to Python, which will execute the operation and return the\nresults back to JavaScript."),(0,i.kt)("h3",{id:"persistent-perspective-viewer-configuration-via-saverestore"},"Persistent ",(0,i.kt)("inlineCode",{parentName:"h3"},"<perspective-viewer>")," configuration via ",(0,i.kt)("inlineCode",{parentName:"h3"},"save()"),"/",(0,i.kt)("inlineCode",{parentName:"h3"},"restore()"),"."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," is ",(0,i.kt)("em",{parentName:"p"},"persistent"),", in that its entire state (sans the data\nitself) can be serialized or deserialized. This include all column, filter,\npivot, expressions, etc. properties, as well as datagrid style settings, config\npanel visibility, and more. This overloaded feature covers a range of use cases:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Setting a ",(0,i.kt)("inlineCode",{parentName:"li"},"<perspective-viewer>"),"'s initial state after a ",(0,i.kt)("inlineCode",{parentName:"li"},"load()")," call."),(0,i.kt)("li",{parentName:"ul"},"Updating a single or subset of properties, without modifying others."),(0,i.kt)("li",{parentName:"ul"},"Resetting some or all properties to their data-relative default."),(0,i.kt)("li",{parentName:"ul"},"Persisting a user's configuration to ",(0,i.kt)("inlineCode",{parentName:"li"},"localStorage")," or a server.")),(0,i.kt)("h4",{id:"serializing-and-deserializing-the-viewer-state"},"Serializing and deserializing the viewer state"),(0,i.kt)("p",null,"To retrieve the entire state as a JSON-ready JavaScript object, use the ",(0,i.kt)("inlineCode",{parentName:"p"},"save()"),"\nmethod. ",(0,i.kt)("inlineCode",{parentName:"p"},"save()")," also supports a few other formats such as ",(0,i.kt)("inlineCode",{parentName:"p"},'"arraybuffer"')," and\n",(0,i.kt)("inlineCode",{parentName:"p"},'"string"')," (base64, not JSON), which you may choose for size at the expense of\neasy migration/manual-editing."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'const json_token = await elem.save();\nconst string_token = await elem.save("string");\n')),(0,i.kt)("p",null,"For any format, the serialized token can be restored to any\n",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," with a ",(0,i.kt)("inlineCode",{parentName:"p"},"Table")," of identical schema, via the ",(0,i.kt)("inlineCode",{parentName:"p"},"restore()"),"\nmethod. Note that while the data for a token returned from ",(0,i.kt)("inlineCode",{parentName:"p"},"save()")," may differ,\ngenerally its schema may not, as many other settings depend on column names and\ntypes."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"await elem.restore(json_token);\nawait elem.restore(string_token);\n")),(0,i.kt)("p",null,"As ",(0,i.kt)("inlineCode",{parentName:"p"},"restore()")," dispatches on the token's type, it is important to make sure that\nthese types match! A common source of error occurs when passing a\nJSON-stringified token to ",(0,i.kt)("inlineCode",{parentName:"p"},"restore()"),", which will assume base64-encoded msgpack\nwhen a string token is used."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},"// This will error!\nawait elem.restore(JSON.stringify(json_token));\n")),(0,i.kt)("h4",{id:"updating-individual-properties"},"Updating individual properties"),(0,i.kt)("p",null,"Using the JSON format, every facet of a ",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>"),"'s configuration\ncan be manipulated from JavaScript using the ",(0,i.kt)("inlineCode",{parentName:"p"},"restore()")," method. The valid\nstructure of properties is described via the\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/finos/perspective/blob/ebced4caa/rust/perspective-viewer/src/ts/viewer.ts#L16"},(0,i.kt)("inlineCode",{parentName:"a"},"ViewerConfig")),"\nand embedded\n",(0,i.kt)("a",{parentName:"p",href:"https://github.com/finos/perspective/blob/ebced4caa19435a2a57d4687be7e428a4efc759b/packages/perspective/index.d.ts#L140"},(0,i.kt)("inlineCode",{parentName:"a"},"ViewConfig")),"\ntype declarations, and ",(0,i.kt)("a",{parentName:"p",href:"/docs/view"},(0,i.kt)("inlineCode",{parentName:"a"},"View"))," chapter of the documentation which has\nseveral interactive examples for each ",(0,i.kt)("inlineCode",{parentName:"p"},"ViewConfig")," property."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'// Set the plugin (will also update `columns` to plugin-defaults)\nawait elem.restore({ plugin: "X Bar" });\n\n// Update plugin and columns (only draws once)\nawait elem.restore({ plugin: "X Bar", columns: ["Sales"] });\n\n// Open the config panel\nawait elem.restore({ settings: true });\n\n// Create an expression\nawait elem.restore({\n    columns: [\'"Sales" + 100\'],\n    expressions: { "New Column": \'"Sales" + 100\' },\n});\n\n// ERROR if the column does not exist in the schema or expressions\n// await elem.restore({columns: ["\\"Sales\\" + 100"], expressions: {}});\n\n// Add a filter\nawait elem.restore({ filter: [["Sales", "<", 100]] });\n\n// Add a sort, don\'t remove filter\nawait elem.restore({ sort: [["Prodit", "desc"]] });\n\n// Reset just filter, preserve sort\nawait elem.restore({ filter: undefined });\n\n// Reset all properties to default e.g. after `load()`\nawait elem.reset();\n')),(0,i.kt)("p",null,"Another effective way to quickly create a token for a desired configuration is\nto simply copy the token returned from ",(0,i.kt)("inlineCode",{parentName:"p"},"save()")," after settings the view manually\nin the browser. The JSON format is human-readable and should be quite easy to\ntweak once generated, as ",(0,i.kt)("inlineCode",{parentName:"p"},"save()")," will return even the default settings for all\nproperties. You can call ",(0,i.kt)("inlineCode",{parentName:"p"},"save()")," in your application code, or e.g. through the\nChrome developer console:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'// Copy to clipboard\ncopy(await document.querySelector("perspective-viewer").save());\n')),(0,i.kt)("h3",{id:"update-events"},"Update events"),(0,i.kt)("p",null,"Whenever a ",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>"),"s underlying ",(0,i.kt)("inlineCode",{parentName:"p"},"table()")," is changed via the\n",(0,i.kt)("inlineCode",{parentName:"p"},"load()")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"update()")," methods, a ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective-view-update")," DOM event is fired.\nSimilarly, ",(0,i.kt)("inlineCode",{parentName:"p"},"view()")," updates instigated either through the Attribute API or\nthrough user interaction will fire a ",(0,i.kt)("inlineCode",{parentName:"p"},"perspective-config-update")," event:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'elem.addEventListener("perspective-config-update", function (event) {\n    var config = elem.save();\n    console.log("The view() config has changed to " + JSON.stringify(config));\n});\n')),(0,i.kt)("h3",{id:"click-events"},"Click events"),(0,i.kt)("p",null,"Whenever a ",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>"),"'s grid or chart is clicked, a\n",(0,i.kt)("inlineCode",{parentName:"p"},"perspective-click")," DOM event is fired containing a detail object with ",(0,i.kt)("inlineCode",{parentName:"p"},"config"),",\n",(0,i.kt)("inlineCode",{parentName:"p"},"column_names"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"row"),"."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"config")," object contains an array of ",(0,i.kt)("inlineCode",{parentName:"p"},"filters")," that can be applied to a\n",(0,i.kt)("inlineCode",{parentName:"p"},"<perspective-viewer>")," through the use of ",(0,i.kt)("inlineCode",{parentName:"p"},"restore()")," updating it to show the\nfiltered subset of data."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"column_names")," property contains an array of matching columns, and the ",(0,i.kt)("inlineCode",{parentName:"p"},"row"),"\nproperty returns the associated row data."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-javascript"},'elem.addEventListener("perspective-click", function (event) {\n    var config = event.detail.config;\n    elem.restore(config);\n});\n')))}c.isMDXComponent=!0}}]);