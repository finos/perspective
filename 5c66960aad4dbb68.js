"use strict";(()=>{var Te=Object.defineProperty;var Ye=(o,p,_)=>p in o?Te(o,p,{enumerable:!0,configurable:!0,writable:!0,value:_}):o[p]=_;var F=(o,p,_)=>(Ye(o,typeof p!="symbol"?p+"":p,_),_);var N=class{constructor(p){F(this,"clients");F(this,"id_gen");F(this,"server");F(this,"module");this.clients=new Map(),this.id_gen=0,this.module=p,this.server=p._psp_new_server();}make_session(p){let _=this.module._psp_new_session(this.server);return this.clients.set(_,p),new X(this.module,this.server,_,this.clients);}delete(){this.module._psp_delete_server(this.server);}},X=class{constructor(p,_,n,l){this.mod=p;this.server=_;this.client_id=n;this.client_map=l;}async handle_request(p){let _=await $e(this.mod,p,async n=>this.mod._psp_handle_request(this.server,this.client_id,n,p.byteLength));await Me(this.mod,_,async n=>{await this.client_map.get(n.client_id)(n.data);});}poll(){let p=this.mod._psp_poll(this.server);Me(this.mod,p,async _=>{await this.client_map.get(_.client_id)(_.data);});}close(){this.mod._psp_close_session(this.server,this.client_id);}};async function $e(o,p,_){let n=o._psp_alloc(p.byteLength);o.HEAPU8.set(p,n);let l=await _(n);return o._psp_free(n),l;}function Je(o,p){let _=o.HEAPU32[p>>>2],n=o.HEAPU32[(p>>>2)+1];return new Uint32Array(o.HEAPU8.buffer,n,_*3);}async function Me(o,p,_){let n=Je(o,p);try{for(let l=0;l<n.length/3;l++){let g=n[l*3],H=n[l*3+1],S=n[l*3+2],h=new Uint8Array(o.HEAPU8.buffer,g,H);await _({client_id:S,data:h});}}finally{for(let l=0;l<n.length/3;l++){let g=n[l*3];o._psp_free(g);}o._psp_free(n.byteOffset),o._psp_free(p);}}var He={},Ge=(()=>{var o=He.url;return function(p={}){var _,n=Object.assign({},p),l,g,H=new Promise((e,t)=>{l=e,g=t;});globalThis.window={};var S=Object.assign({},n),h="";typeof document<"u"&&document.currentScript&&(h=document.currentScript.src),o&&(h=o),h.startsWith("blob:")?h="":h=h.substr(0,h.replace(/[?#].*/,"").lastIndexOf("/")+1);var b=console.log.bind(console),U=console.error.bind(console);Object.assign(n,S),S=null;var ee,j=!1,T,x,d,w,te,re;function ne(){var e=ee.buffer;n.HEAP8=T=new Int8Array(e),n.HEAP16=new Int16Array(e),n.HEAPU8=x=new Uint8Array(e),n.HEAPU16=new Uint16Array(e),n.HEAP32=d=new Int32Array(e),n.HEAPU32=w=new Uint32Array(e),n.HEAPF32=new Float32Array(e),n.HEAPF64=re=new Float64Array(e),n.HEAP64=te=new BigInt64Array(e),n.HEAPU64=new BigUint64Array(e);}var De=[],We=[],Fe=[],Re=[],se=!1,I=0,Y=null,k=null;function ae(e){throw e="Aborted("+e+")",U(e),j=!0,e+=". Build with -sASSERTIONS for more info.",se&&ge(),e=new WebAssembly.RuntimeError(e),g(e),e;}var ie=e=>e.startsWith("data:application/octet-stream;base64,"),M;if(n.locateFile){if(M="perspective-server.wasm",!ie(M)){var oe=M;M=n.locateFile?n.locateFile(oe,h):h+oe;}}else M=new URL("perspective-server.wasm",He.url).href;function pe(){throw"both async and sync fetching of the wasm failed";}function ze(e){return typeof fetch=="function"?fetch(e,{credentials:"same-origin"}).then(t=>{if(!t.ok)throw`failed to load wasm binary file at '${e}'`;return t.arrayBuffer();}).catch(()=>pe()):Promise.resolve().then(()=>pe());}function _e(e,t,r){return ze(e).then(a=>WebAssembly.instantiate(a,t)).then(r,a=>{U(`failed to asynchronously prepare wasm: ${a}`),ae(a);});}function Ce(e,t){var r=M;return typeof WebAssembly.instantiateStreaming!="function"||ie(r)||typeof fetch!="function"?_e(r,e,t):fetch(r,{credentials:"same-origin"}).then(a=>WebAssembly.instantiateStreaming(a,e).then(t,function(s){return U(`wasm streaming compile failed: ${s}`),U("falling back to ArrayBuffer instantiation"),_e(r,e,t);}));}var Oe={884784:()=>typeof wasmOffsetConverter<"u"};function ce(e){this.name="ExitStatus",this.message=`Program terminated with exit(${e})`,this.status=e;}var R=e=>{for(;0<e.length;)e.shift()(n);},le=new TextDecoder("utf8"),z=e=>{if(e>>>=0,!e)return"";for(var t=e+NaN,r=e;!(r>=t)&&x[r>>>0];)++r;return le.decode(x.subarray(e>>>0,r>>>0));},ue=e=>{e=e.getArg(u.__cpp_exception,0);var t=Ee(e);e=we();var r=Z(4),a=Z(4);if(Pe(t,r,a),t=w[r>>>2>>>0],a=w[a>>>2>>>0],r=z(t),K(t),a){var s=z(a);K(a);}return Ae(e),[r,s];};n.getExceptionMessage=ue;var me;me=()=>performance.now();var $=[],J={},fe=()=>{if(!G){var e={USER:"web_user",LOGNAME:"web_user",PATH:"/",PWD:"/",HOME:"/home/web_user",LANG:(typeof navigator=="object"&&navigator.languages&&navigator.languages[0]||"C").replace("-","_")+".UTF-8",_:"./this.program"},t;for(t in J)J[t]===void 0?delete e[t]:e[t]=J[t];var r=[];for(t in e)r.push(`${t}=${e[t]}`);G=r;}return G;},G,Be=[null,[],[]],de=e=>{throw j=!0,new ce(e);},q=e=>e%4===0&&(e%100!==0||e%400===0),ye=(e,t)=>{for(var r=0,a=0;a<=t;r+=e[a++]);return r;},C=[31,29,31,30,31,30,31,31,30,31,30,31],O=[31,28,31,30,31,30,31,31,30,31,30,31],B=(e,t)=>{for(e=new Date(e.getTime());0<t;){var r=e.getMonth(),a=(q(e.getFullYear())?C:O)[r];if(t>a-e.getDate())t-=a-e.getDate()+1,e.setDate(1),11>r?e.setMonth(r+1):(e.setMonth(0),e.setFullYear(e.getFullYear()+1));else{e.setDate(e.getDate()+t);break;}}return e;};function Le(e){for(var t=0,r=0;r<e.length;++r){var a=e.charCodeAt(r);127>=a?t++:2047>=a?t+=2:55296<=a&&57343>=a?(t+=4,++r):t+=3;}if(t=Array(t+1),a=t.length,r=0,0<a){a=r+a-1;for(var s=0;s<e.length;++s){var c=e.charCodeAt(s);if(55296<=c&&57343>=c){var D=e.charCodeAt(++s);c=65536+((c&1023)<<10)|D&1023;}if(127>=c){if(r>=a)break;t[r++>>>0]=c;}else{if(2047>=c){if(r+1>=a)break;t[r++>>>0]=192|c>>6;}else{if(65535>=c){if(r+2>=a)break;t[r++>>>0]=224|c>>12;}else{if(r+3>=a)break;t[r++>>>0]=240|c>>18,t[r++>>>0]=128|c>>12&63;}t[r++>>>0]=128|c>>6&63;}t[r++>>>0]=128|c&63;}}t[r>>>0]=0;}return t;}var ve={HaveOffsetConverter:function(){return typeof wasmOffsetConverter<"u";},__syscall_ftruncate64:function(){},__syscall_getdents64:function(){},__throw_exception_with_stack_trace:e=>{throw e=new WebAssembly.Exception(u.__cpp_exception,[e],{traceStack:!0}),e.message=ue(e),e;},clock_time_get:function(e,t,r){if(r>>>=0,e!=0&&e!=1&&e!=2&&e!=3)return 28;var a;return e===0?a=Date.now():a=me(),e=Math.round(1e6*a),d[r>>>2>>>0]=e>>>0,d[r+4>>>2>>>0]=e/Math.pow(2,32)>>>0,0;},emscripten_asm_const_int:function(e,t,r){e>>>=0,t>>>=0,r>>>=0,$.length=0;for(var a;a=x[t++>>>0];){var s=a!=105;s&=a!=112,r+=s&&r%8?4:0,$.push(a==112?w[r>>>2>>>0]:a==106?te[r>>>3]:a==105?d[r>>>2>>>0]:re[r>>>3>>>0]),r+=s?8:4;}return Oe[e](...$);},emscripten_notify_memory_growth:function(){ne();},environ_get:function(e,t){e>>>=0,t>>>=0;var r=0;return fe().forEach((a,s)=>{var c=t+r;for(s=w[e+4*s>>>2>>>0]=c,c=0;c<a.length;++c)T[s++>>>0]=a.charCodeAt(c);T[s>>>0]=0,r+=a.length+1;}),0;},environ_sizes_get:function(e,t){e>>>=0,t>>>=0;var r=fe();w[e>>>2>>>0]=r.length;var a=0;return r.forEach(s=>a+=s.length+1),w[t>>>2>>>0]=a,0;},fd_close:()=>52,fd_read:function(){return 52;},fd_seek:function(){return 70;},fd_write:function(e,t,r,a){t>>>=0,r>>>=0,a>>>=0;for(var s=0,c=0;c<r;c++){var D=w[t>>>2>>>0],m=w[t+4>>>2>>>0];t+=8;for(var y=0;y<m;y++){var f=x[D+y>>>0],E=Be[e];if(f===0||f===10){f=0,f>>>=0;for(var W=f+NaN,i=f;E[i]&&!(i>=W);)++i;f=le.decode(E.buffer?E.subarray(f,i):new Uint8Array(E.slice(f,i))),(e===1?b:U)(f),E.length=0;}else E.push(f);}s+=m;}return w[a>>>2>>>0]=s,0;},proc_exit:de,psp_heap_size:function(){ae("missing function: psp_heap_size");},strptime:function(e,t,r){function a(){function v(A,V,Ue){return typeof A!="number"||isNaN(A)?V:A>=V?A<=Ue?A:Ue:V;}return{year:v(d[r+20>>>2>>>0]+1900,1970,9999),month:v(d[r+16>>>2>>>0],0,11),day:v(d[r+12>>>2>>>0],1,31),hour:v(d[r+8>>>2>>>0],0,23),min:v(d[r+4>>>2>>>0],0,59),i:v(d[r>>>2>>>0],0,59),g:0};}e>>>=0,r>>>=0,t=z(t>>>0);for(var s=0;25>s;++s)t=t.replace(new RegExp("\\"+"\\!@#$^&*()+=-[]/{}|:<>?,."[s],"g"),"\\"+"\\!@#$^&*()+=-[]/{}|:<>?,."[s]);var c={A:"%a",B:"%b",c:"%a %b %d %H:%M:%S %Y",D:"%m\\/%d\\/%y",e:"%d",F:"%Y-%m-%d",h:"%b",R:"%H\\:%M",r:"%I\\:%M\\:%S\\s%p",T:"%H\\:%M\\:%S",x:"%m\\/%d\\/(?:%y|%Y)",X:"%H\\:%M\\:%S"},D={a:"(?:Sun(?:day)?)|(?:Mon(?:day)?)|(?:Tue(?:sday)?)|(?:Wed(?:nesday)?)|(?:Thu(?:rsday)?)|(?:Fri(?:day)?)|(?:Sat(?:urday)?)",b:"(?:Jan(?:uary)?)|(?:Feb(?:ruary)?)|(?:Mar(?:ch)?)|(?:Apr(?:il)?)|May|(?:Jun(?:e)?)|(?:Jul(?:y)?)|(?:Aug(?:ust)?)|(?:Sep(?:tember)?)|(?:Oct(?:ober)?)|(?:Nov(?:ember)?)|(?:Dec(?:ember)?)",C:"\\d\\d",d:"0[1-9]|[1-9](?!\\d)|1\\d|2\\d|30|31",H:"\\d(?!\\d)|[0,1]\\d|20|21|22|23",I:"\\d(?!\\d)|0\\d|10|11|12",j:"00[1-9]|0?[1-9](?!\\d)|0?[1-9]\\d(?!\\d)|[1,2]\\d\\d|3[0-6]\\d",m:"0[1-9]|[1-9](?!\\d)|10|11|12",M:"0\\d|\\d(?!\\d)|[1-5]\\d",n:" ",p:"AM|am|PM|pm|A\\.M\\.|a\\.m\\.|P\\.M\\.|p\\.m\\.",S:"0\\d|\\d(?!\\d)|[1-5]\\d|60",U:"0\\d|\\d(?!\\d)|[1-4]\\d|50|51|52|53",W:"0\\d|\\d(?!\\d)|[1-4]\\d|50|51|52|53",w:"[0-6]",y:"\\d\\d",Y:"\\d\\d\\d\\d",t:" ",z:"Z|(?:[\\+\\-]\\d\\d:?(?:\\d\\d)?)"},m={P:0,O:1,$:2,K:3,aa:4,Z:5,V:6,L:7,da:8,ca:9,ba:10,N:11},y={u:0,o:1,G:2,J:3,v:4,l:5,s:6},f={o:0,G:1,J:2,v:3,l:4,s:5,u:6},E=[];t=t.replace(/%(.)/g,(v,A)=>c[A]||v).replace(/%(.)/g,(v,A)=>(v=D[A])?(E.push(A),`(${v})`):A).replace(/\s+/g,"\\s*");var W=new RegExp("^"+t,"i").exec(z(e));if(W){t=a();var i;if(s=v=>{if(v=E.indexOf(v),0<=v)return W[v+1];},(i=s("S"))&&(t.i=parseInt(i)),(i=s("M"))&&(t.min=parseInt(i)),i=s("H"))t.hour=parseInt(i);else if(i=s("I")){var P=parseInt(i);(i=s("p"))&&(P+=i.toUpperCase()[0]==="P"?12:0),t.hour=P;}if((i=s("Y"))?t.year=parseInt(i):(i=s("y"))&&(P=parseInt(i),P=(i=s("C"))?P+100*parseInt(i):P+(69>P?2e3:1900),t.year=P),(i=s("m"))?t.month=parseInt(i)-1:(i=s("b"))&&(t.month=m[i.substring(0,3).toUpperCase()]||0),i=s("d"))t.day=parseInt(i);else if(i=s("j"))for(y=parseInt(i),f=q(t.year),m=0;12>m;++m)i=ye(f?C:O,m-1),y<=i+(f?C:O)[m]&&(t.day=y-i);else(i=s("a"))&&(m=i.substring(0,3).toUpperCase(),(i=s("U"))?(y=y[m],f=parseInt(i),m=new Date(t.year,0,1),y=m.getDay()===0?B(m,y+7*(f-1)):B(m,7-m.getDay()+y+7*(f-1)),t.day=y.getDate(),t.month=y.getMonth()):(i=s("W"))&&(y=f[m],f=parseInt(i),m=new Date(t.year,0,1),y=m.getDay()===1?B(m,y+7*(f-1)):B(m,7-m.getDay()+1+y+7*(f-1)),t.day=y.getDate(),t.month=y.getMonth()));return(i=s("z"))&&(i.toLowerCase()==="z"?t.g=0:(s=i.match(/^((?:\-|\+)\d\d):?(\d\d)?/),t.g=3600*s[1],s[2]&&(t.g+=0<t.g?60*s[2]:60*-s[2]))),s=new Date(t.year,t.month,t.day,t.hour,t.min,t.i,0),d[r>>>2>>>0]=s.getSeconds(),d[r+4>>>2>>>0]=s.getMinutes(),d[r+8>>>2>>>0]=s.getHours(),d[r+12>>>2>>>0]=s.getDate(),d[r+16>>>2>>>0]=s.getMonth(),d[r+20>>>2>>>0]=s.getFullYear()-1900,d[r+24>>>2>>>0]=s.getDay(),d[r+28>>>2>>>0]=ye(q(s.getFullYear())?C:O,s.getMonth()-1)+s.getDate()-1,d[r+32>>>2>>>0]=0,d[r+36>>>2>>>0]=t.g,e+Le(W[0]).length-1;}return 0;}},u=function(){function e(r){return u=r.exports,u=Ne(),ee=u.memory,ne(),I--,I==0&&(Y!==null&&(clearInterval(Y),Y=null),k&&(r=k,k=null,r())),u;}var t={env:ve,wasi_snapshot_preview1:ve};if(I++,n.instantiateWasm)try{return n.instantiateWasm(t,e);}catch(r){U(`Module.instantiateWasm callback failed with error: ${r}`),g(r);}return Ce(t,function(r){e(r.instance);}).catch(g),{};}();n._psp_new_server=()=>(n._psp_new_server=u.psp_new_server)(),n._psp_handle_request=(e,t,r,a)=>(n._psp_handle_request=u.psp_handle_request)(e,t,r,a),n._psp_poll=e=>(n._psp_poll=u.psp_poll)(e),n._psp_new_session=e=>(n._psp_new_session=u.psp_new_session)(e),n._psp_close_session=(e,t)=>(n._psp_close_session=u.psp_close_session)(e,t),n._psp_alloc=e=>(n._psp_alloc=u.psp_alloc)(e),n._psp_free=e=>(n._psp_free=u.psp_free)(e);var K=e=>(K=u.free)(e);n._psp_delete_server=e=>(n._psp_delete_server=u.psp_delete_server)(e);var he=n.__initialize=()=>(he=n.__initialize=u._initialize)(),ge=()=>(ge=u.__trap)(),Ae=e=>(Ae=u._emscripten_stack_restore)(e),Z=e=>(Z=u._emscripten_stack_alloc)(e),we=()=>(we=u.emscripten_stack_get_current)(),Ee=e=>(Ee=u.__thrown_object_from_unwind_exception)(e),Pe=(e,t,r)=>(Pe=u.__get_exception_message)(e,t,r);n.___start_em_js=884841,n.___stop_em_js=884902;function Ne(){var e=u;return e=Object.assign({},e),e._emscripten_stack_alloc=(t=>r=>t(r)>>>0)(e._emscripten_stack_alloc),e.emscripten_stack_get_current=(t=>()=>t()>>>0)(e.emscripten_stack_get_current),e;}var L;k=function e(){L||be(),L||(k=e);};function be(){if(!(0<I||(R(De),0<I||L||(L=!0,n.calledRun=!0,j)))){if(se=!0,R(We),R(Fe),l(n),je){var e=he;try{e(),de(0);}catch(t){if(!(t instanceof ce||t=="unwind"))throw t;}}R(Re);}}var je=!0;return be(),_=H,_;};})(),Se=Ge;if(typeof WebAssembly>"u")throw new Error("WebAssembly not supported.");async function Ke(o){return o instanceof Function&&(o=await o()),o instanceof Response?await WebAssembly.instantiateStreaming(o):await WebAssembly.instantiate(o);}async function xe(o){let _=(await Ke(o)).instance.exports,n=_.size(),l=_.offset();return new Uint8Array(_.memory.buffer).slice(l,l+n);}async function Ie(o){let p=await Se({locateFile(_){return _;},instantiateWasm:async(_,n)=>{let l=await xe(o);_.env={..._.env,psp_stack_trace(){let H=Error().stack||"",h=new TextEncoder().encode(H),b=p._psp_alloc(h.byteLength+1);return p.HEAPU8.set(h,b),p.HEAPU8[b+h.byteLength]=0,b;},psp_heap_size(){return p.HEAP8.buffer.byteLength;}};let g=await WebAssembly.instantiate(l,_);return n(g.instance),g.instance.exports;}});return p;}var ke,Q;self.addEventListener("message",async o=>{if(o.data.cmd==="init"){let p=o.data.id,_=await Ie(o.data.args[0]);ke=new N(_),Q=ke.make_session(async n=>{let l=n.slice().buffer;self.postMessage(l,{transfer:[l]});}),self.postMessage({id:p});}else Q.handle_request(new Uint8Array(o.data)),setTimeout(()=>Q.poll());});})();